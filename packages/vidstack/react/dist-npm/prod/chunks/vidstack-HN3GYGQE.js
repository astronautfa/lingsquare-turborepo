import{d as y}from"./vidstack-5LA5YANY.js";import{A as v,B as l,d as C,e as f,ma as E,p,q as h,t as x,v as c}from"./vidstack-YO4XO2QW.js";function K(s,e){for(let n=0,t=s.length;n<t;n++)if(u(s[n],e))return s[n];return null}function u(s,e){return e>=s.startTime&&e<s.endTime}function k(s,e,n){let t=null,i=C();function r(){let o=h(e)?[e]:e,T=s.toArray().find(d=>o.includes(d.kind)&&d.mode==="showing");if(T!==t){if(!T){n(null),t=null;return}T.readyState==2?n(T):(n(null),f(()=>{let d=l(T,"load",()=>{n(T),d()},{once:!0})},i)),t=T}}return r(),l(s,"mode-change",r)}function L(s,e,n){k(s,e,t=>{if(!t){n("");return}let i=()=>{let r=t?.activeCues[0];n(r?.text||"")};i(),l(t,"cue-change",i)})}var _=Symbol(0),V=Symbol(0),S=Symbol(0),A=Symbol(0),R=Symbol(0),b=Symbol(0),O=Symbol(0),a={crossOrigin:_,readyState:V,updateActiveCues:S,canLoad:A,onModeChange:R,native:b,nativeHLS:O};var m=class extends v{static createId(e){return`vds-${e.type}-${e.kind}-${e.src??e.label??"?"}`}src;content;type;encoding;id="";label="";language="";kind;default=!1;#s=!1;#t=0;#i="disabled";#o={};#r=[];#e=[];#n=[];[a.readyState]=0;[a.crossOrigin];[a.onModeChange]=null;[a.native]=null;get metadata(){return this.#o}get regions(){return this.#r}get cues(){return this.#e}get activeCues(){return this.#n}get readyState(){return this[a.readyState]}get mode(){return this.#i}set mode(e){this.setMode(e)}constructor(e){super();for(let n of Object.keys(e))this[n]=e[n];this.type||(this.type="vtt"),!E&&e.content?this.#l(e):e.src||(this[a.readyState]=2)}addCue(e,n){let t=0,i=this.#e.length;for(t=0;t<i&&!(e.endTime<=this.#e[t].startTime);t++);t===i?this.#e.push(e):this.#e.splice(t,0,e),e instanceof TextTrackCue||this[a.native]?.track.addCue(e),this.dispatchEvent(new c("add-cue",{detail:e,trigger:n})),u(e,this.#t)&&this[a.updateActiveCues](this.#t,n)}removeCue(e,n){let t=this.#e.indexOf(e);if(t>=0){let i=this.#n.includes(e);this.#e.splice(t,1),this[a.native]?.track.removeCue(e),this.dispatchEvent(new c("remove-cue",{detail:e,trigger:n})),i&&this[a.updateActiveCues](this.#t,n)}}setMode(e,n){this.#i!==e&&(this.#i=e,e==="disabled"?(this.#n=[],this.#h()):this.readyState===2?this[a.updateActiveCues](this.#t,n):this.#T(),this.dispatchEvent(new c("mode-change",{detail:this,trigger:n})),this[a.onModeChange]?.())}[a.updateActiveCues](e,n){if(this.#t=e,this.mode==="disabled"||!this.#e.length)return;let t=[];for(let r=0,o=this.#e.length;r<o;r++){let T=this.#e[r];u(T,e)&&t.push(T)}let i=t.length!==this.#n.length;if(!i){for(let r=0;r<t.length;r++)if(!this.#n.includes(t[r])){i=!0;break}}this.#n=t,i&&this.#h(n)}[a.canLoad](){this.#s=!0,this.#i!=="disabled"&&this.#T()}#l(e){import("media-captions").then(({parseText:n,VTTCue:t,VTTRegion:i})=>{!h(e.content)||e.type==="json"?(this.#d(e.content,t,i),this.readyState!==3&&this.#a()):n(e.content,{type:e.type}).then(({cues:r,regions:o})=>{this.#e=r,this.#r=o,this.#a()})})}async#T(){if(!(!this.#s||this[a.readyState]>0)){if(this[a.readyState]=1,this.dispatchEvent(new c("load-start")),!this.src){this.#a();return}try{let{parseResponse:e,VTTCue:n,VTTRegion:t}=await import("media-captions"),i=this[a.crossOrigin]?.(),r=fetch(this.src,{headers:this.type==="json"?{"Content-Type":"application/json"}:void 0,credentials:y(i)});if(this.type==="json")this.#d(await(await r).text(),n,t);else{let{errors:o,metadata:T,regions:d,cues:g}=await e(r,{type:this.type,encoding:this.encoding});if(o[0]?.code===0)throw o[0];this.#o=T,this.#r=d,this.#e=g}this.#a()}catch(e){this.#c(e)}}}#a(){if(this[a.readyState]=2,!this.src||this.type!=="vtt"){let n=this[a.native];if(n&&!n.managed)for(let t of this.#e)n.track.addCue(t)}let e=new c("load");this[a.updateActiveCues](this.#t,e),this.dispatchEvent(e)}#c(e){this[a.readyState]=3,this.dispatchEvent(new c("error",{detail:e}))}#d(e,n,t){try{let{regions:i,cues:r}=I(e,n,t);this.#r=i,this.#e=r}catch(i){this.#c(i)}}#h(e){this.dispatchEvent(new c("cue-change",{trigger:e}))}},D=/captions|subtitles/;function J(s){return D.test(s.kind)}function I(s,e,n){let t=h(s)?JSON.parse(s):s,i=[],r=[];return t.regions&&n&&(i=t.regions.map(o=>Object.assign(new n,o))),(t.cues||x(t))&&(r=(x(t)?t:t.cues).filter(o=>p(o.startTime)&&p(o.endTime)).map(o=>Object.assign(new e(0,0,""),o))),{regions:i,cues:r}}export{a,K as b,u as c,k as d,L as e,m as f,J as g,I as h};
