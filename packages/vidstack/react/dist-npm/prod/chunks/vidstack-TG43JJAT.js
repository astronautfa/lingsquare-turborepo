import{a as v,b as y}from"./vidstack-5UDFHBMF.js";import{a as o,f as g}from"./vidstack-IMDQ4X5U.js";import{i as x,j as s,k as c}from"./vidstack-7FJQKULN.js";import{B as n,e as P,f as a,v as E}from"./vidstack-7GZB5QIO.js";var d=class{#e;#i;constructor(e,t){this.#e=e,this.#i=t,e.textTracks.onaddtrack=this.#t.bind(this),a(this.#r.bind(this))}#t(e){let t=e.track;if(!t||V(this.#e,t))return;let i=new g({id:t.id,kind:t.kind,label:t.label??"",language:t.language,type:"vtt"});i[o.native]={track:t},i[o.readyState]=2,i[o.nativeHLS]=!0;let f=0,M=k=>{if(t.cues)for(let h=f;h<t.cues.length;h++)i.addCue(t.cues[h],k),f++};M(e),t.oncuechange=M,this.#i.textTracks.add(i,e),i.setMode(t.mode,e)}#r(){this.#e.textTracks.onaddtrack=null;for(let e of this.#i.textTracks){let t=e[o.native]?.track;t?.oncuechange&&(t.oncuechange=null)}}};function V(r,e){return Array.from(r.children).find(t=>t.track===e)}var p=class{#e;#i;constructor(e,t){this.#e=e,this.#i=t,n(e,"enterpictureinpicture",this.#t.bind(this)),n(e,"leavepictureinpicture",this.#r.bind(this))}get active(){return document.pictureInPictureElement===this.#e}get supported(){return s(this.#e)}async enter(){return this.#e.requestPictureInPicture()}exit(){return document.exitPictureInPicture()}#t(e){this.#n(!0,e)}#r(e){this.#n(!1,e)}#n=(e,t)=>{this.#i.notify("picture-in-picture-change",e,t)}};var u=class{#e;#i;#t="inline";get mode(){return this.#t}constructor(e,t){this.#e=e,this.#i=t,n(e,"webkitpresentationmodechanged",this.#r.bind(this))}get supported(){return c(this.#e)}async setPresentationMode(e){this.#t!==e&&this.#e.webkitSetPresentationMode(e)}#r(e){let t=this.#t;this.#t=this.#e.webkitPresentationMode,this.#i.player?.dispatch(new E("video-presentation-change",{detail:this.#t,trigger:e})),["fullscreen","picture-in-picture"].forEach(i=>{(this.#t===i||t===i)&&this.#i.notify(`${i}-change`,this.#t===i,e)})}},l=class{#e;get active(){return this.#e.mode==="fullscreen"}get supported(){return this.#e.supported}constructor(e){this.#e=e}async enter(){this.#e.setPresentationMode("fullscreen")}async exit(){this.#e.setPresentationMode("inline")}},m=class{#e;get active(){return this.#e.mode==="picture-in-picture"}get supported(){return this.#e.supported}constructor(e){this.#e=e}async enter(){this.#e.setPresentationMode("picture-in-picture")}async exit(){this.#e.setPresentationMode("inline")}};var T=class extends v{$$PROVIDER_TYPE="VIDEO";get type(){return"video"}airPlay;fullscreen;pictureInPicture;constructor(e,t){super(e,t),P(()=>{if(this.airPlay=new y(e,t),c(e)){let i=new u(e,t);this.fullscreen=new l(i),this.pictureInPicture=new m(i)}else s(e)&&(this.pictureInPicture=new p(e,t))},this.scope)}setup(){super.setup(),x(this.video)&&new d(this.video,this.ctx),this.ctx.textRenderers.attachVideo(this.video),a(()=>{this.ctx.textRenderers.attachVideo(null)}),this.type==="video"&&this.ctx.notify("provider-setup",this)}get video(){return this.media}};export{T as a};
