import{d as y}from"./vidstack-DHW3MMHQ.js";import{d as C,e as v,m as u,n as h,q as p,r as c,s as f,t as l}from"./vidstack-BQB2M2TQ.js";var m=Symbol(0),k=Symbol(0),_=Symbol(0),V=Symbol(0),S=Symbol(0),A=Symbol(0),R=Symbol(0),a={crossOrigin:m,readyState:k,updateActiveCues:_,canLoad:V,onModeChange:S,native:A,nativeHLS:R};function x(o,e){return e>=o.startTime&&e<o.endTime}function b(o,e,n){let t=null,i=C();function r(){let s=h(e)?[e]:e,T=o.toArray().find(d=>s.includes(d.kind)&&d.mode==="showing");if(T!==t){if(!T){n(null),t=null;return}T.readyState==2?n(T):(n(null),v(()=>{let d=l(T,"load",()=>{n(T),d()},{once:!0})},i)),t=T}}return r(),l(o,"mode-change",r)}function K(o,e,n){b(o,e,t=>{if(!t){n("");return}let i=()=>{let r=t?.activeCues[0];n(r?.text||"")};i(),l(t,"cue-change",i)})}var E=class extends f{static createId(e){return`vds-${e.type}-${e.kind}-${e.src??e.label??"?"}`}src;content;type;encoding;id="";label="";language="";kind;default=!1;#s=!1;#t=0;#i="disabled";#o={};#r=[];#e=[];#n=[];[a.readyState]=0;[a.crossOrigin];[a.onModeChange]=null;[a.native]=null;get metadata(){return this.#o}get regions(){return this.#r}get cues(){return this.#e}get activeCues(){return this.#n}get readyState(){return this[a.readyState]}get mode(){return this.#i}set mode(e){this.setMode(e)}constructor(e){super();for(let n of Object.keys(e))this[n]=e[n];this.type||(this.type="vtt"),e.content?this.#l(e):e.src||(this[a.readyState]=2)}addCue(e,n){let t=0,i=this.#e.length;for(t=0;t<i&&!(e.endTime<=this.#e[t].startTime);t++);t===i?this.#e.push(e):this.#e.splice(t,0,e),e instanceof TextTrackCue||this[a.native]?.track.addCue(e),this.dispatchEvent(new c("add-cue",{detail:e,trigger:n})),x(e,this.#t)&&this[a.updateActiveCues](this.#t,n)}removeCue(e,n){let t=this.#e.indexOf(e);if(t>=0){let i=this.#n.includes(e);this.#e.splice(t,1),this[a.native]?.track.removeCue(e),this.dispatchEvent(new c("remove-cue",{detail:e,trigger:n})),i&&this[a.updateActiveCues](this.#t,n)}}setMode(e,n){this.#i!==e&&(this.#i=e,e==="disabled"?(this.#n=[],this.#h()):this.readyState===2?this[a.updateActiveCues](this.#t,n):this.#T(),this.dispatchEvent(new c("mode-change",{detail:this,trigger:n})),this[a.onModeChange]?.())}[a.updateActiveCues](e,n){if(this.#t=e,this.mode==="disabled"||!this.#e.length)return;let t=[];for(let r=0,s=this.#e.length;r<s;r++){let T=this.#e[r];x(T,e)&&t.push(T)}let i=t.length!==this.#n.length;if(!i){for(let r=0;r<t.length;r++)if(!this.#n.includes(t[r])){i=!0;break}}this.#n=t,i&&this.#h(n)}[a.canLoad](){this.#s=!0,this.#i!=="disabled"&&this.#T()}#l(e){import("https://cdn.jsdelivr.net/npm/media-captions@next/dist/prod.js").then(({parseText:n,VTTCue:t,VTTRegion:i})=>{!h(e.content)||e.type==="json"?(this.#d(e.content,t,i),this.readyState!==3&&this.#a()):n(e.content,{type:e.type}).then(({cues:r,regions:s})=>{this.#e=r,this.#r=s,this.#a()})})}async#T(){if(!(!this.#s||this[a.readyState]>0)){if(this[a.readyState]=1,this.dispatchEvent(new c("load-start")),!this.src){this.#a();return}try{let{parseResponse:e,VTTCue:n,VTTRegion:t}=await import("https://cdn.jsdelivr.net/npm/media-captions@next/dist/prod.js"),i=this[a.crossOrigin]?.(),r=fetch(this.src,{headers:this.type==="json"?{"Content-Type":"application/json"}:void 0,credentials:y(i)});if(this.type==="json")this.#d(await(await r).text(),n,t);else{let{errors:s,metadata:T,regions:d,cues:g}=await e(r,{type:this.type,encoding:this.encoding});if(s[0]?.code===0)throw s[0];this.#o=T,this.#r=d,this.#e=g}this.#a()}catch(e){this.#c(e)}}}#a(){if(this[a.readyState]=2,!this.src||this.type!=="vtt"){let n=this[a.native];if(n&&!n.managed)for(let t of this.#e)n.track.addCue(t)}let e=new c("load");this[a.updateActiveCues](this.#t,e),this.dispatchEvent(e)}#c(e){this[a.readyState]=3,this.dispatchEvent(new c("error",{detail:e}))}#d(e,n,t){try{let{regions:i,cues:r}=D(e,n,t);this.#r=i,this.#e=r}catch(i){this.#c(i)}}#h(e){this.dispatchEvent(new c("cue-change",{trigger:e}))}},O=/captions|subtitles/;function X(o){return O.test(o.kind)}function D(o,e,n){let t=h(o)?JSON.parse(o):o,i=[],r=[];return t.regions&&n&&(i=t.regions.map(s=>Object.assign(new n,s))),(t.cues||p(t))&&(r=(p(t)?t:t.cues).filter(s=>u(s.startTime)&&u(s.endTime)).map(s=>Object.assign(new e(0,0,""),s))),{regions:i,cues:r}}export{a,x as b,b as c,K as d,E as e,X as f};
