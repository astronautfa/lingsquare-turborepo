import{b as u}from"./vidstack-CRUGUF5W.js";import{d as v}from"./vidstack-BQBKKLOB.js";import{m as c,n as h,q as l,r as o,w as p}from"./vidstack-XC7WIXLW.js";var y=Symbol(0),f=Symbol(0),_=Symbol(0),g=Symbol(0),k=Symbol(0),m=Symbol(0),V=Symbol(0),i={crossOrigin:y,readyState:f,updateActiveCues:_,canLoad:g,onModeChange:k,native:m,nativeHLS:V};var C=class extends p{static createId(e){return`vds-${e.type}-${e.kind}-${e.src??e.label??"?"}`}src;content;type;encoding;id="";label="";language="";kind;default=!1;#s=!1;#t=0;#i="disabled";#o={};#n=[];#e=[];#a=[];[i.readyState]=0;[i.crossOrigin];[i.onModeChange]=null;[i.native]=null;get metadata(){return this.#o}get regions(){return this.#n}get cues(){return this.#e}get activeCues(){return this.#a}get readyState(){return this[i.readyState]}get mode(){return this.#i}set mode(e){this.setMode(e)}constructor(e){super();for(let a of Object.keys(e))this[a]=e[a];this.type||(this.type="vtt"),e.content?this.#l(e):e.src||(this[i.readyState]=2)}addCue(e,a){let t=0,n=this.#e.length;for(t=0;t<n&&!(e.endTime<=this.#e[t].startTime);t++);t===n?this.#e.push(e):this.#e.splice(t,0,e),e instanceof TextTrackCue||this[i.native]?.track.addCue(e),this.dispatchEvent(new o("add-cue",{detail:e,trigger:a})),u(e,this.#t)&&this[i.updateActiveCues](this.#t,a)}removeCue(e,a){let t=this.#e.indexOf(e);if(t>=0){let n=this.#a.includes(e);this.#e.splice(t,1),this[i.native]?.track.removeCue(e),this.dispatchEvent(new o("remove-cue",{detail:e,trigger:a})),n&&this[i.updateActiveCues](this.#t,a)}}setMode(e,a){this.#i!==e&&(this.#i=e,e==="disabled"?(this.#a=[],this.#h()):this.readyState===2?this[i.updateActiveCues](this.#t,a):this.#T(),this.dispatchEvent(new o("mode-change",{detail:this,trigger:a})),this[i.onModeChange]?.())}[i.updateActiveCues](e,a){if(this.#t=e,this.mode==="disabled"||!this.#e.length)return;let t=[];for(let r=0,s=this.#e.length;r<s;r++){let d=this.#e[r];u(d,e)&&t.push(d)}let n=t.length!==this.#a.length;if(!n){for(let r=0;r<t.length;r++)if(!this.#a.includes(t[r])){n=!0;break}}this.#a=t,n&&this.#h(a)}[i.canLoad](){this.#s=!0,this.#i!=="disabled"&&this.#T()}#l(e){import("media-captions").then(({parseText:a,VTTCue:t,VTTRegion:n})=>{!h(e.content)||e.type==="json"?(this.#c(e.content,t,n),this.readyState!==3&&this.#r()):a(e.content,{type:e.type}).then(({cues:r,regions:s})=>{this.#e=r,this.#n=s,this.#r()})})}async#T(){if(!(!this.#s||this[i.readyState]>0)){if(this[i.readyState]=1,this.dispatchEvent(new o("load-start")),!this.src){this.#r();return}try{let{parseResponse:e,VTTCue:a,VTTRegion:t}=await import("media-captions"),n=this[i.crossOrigin]?.(),r=fetch(this.src,{headers:this.type==="json"?{"Content-Type":"application/json"}:void 0,credentials:v(n)});if(this.type==="json")this.#c(await(await r).text(),a,t);else{let{errors:s,metadata:d,regions:x,cues:E}=await e(r,{type:this.type,encoding:this.encoding});if(s[0]?.code===0)throw s[0];this.#o=d,this.#n=x,this.#e=E}this.#r()}catch(e){this.#d(e)}}}#r(){if(this[i.readyState]=2,!this.src||this.type!=="vtt"){let a=this[i.native];if(a&&!a.managed)for(let t of this.#e)a.track.addCue(t)}let e=new o("load");this[i.updateActiveCues](this.#t,e),this.dispatchEvent(e)}#d(e){this[i.readyState]=3,this.dispatchEvent(new o("error",{detail:e}))}#c(e,a,t){try{let{regions:n,cues:r}=A(e,a,t);this.#n=n,this.#e=r}catch(n){this.#d(n)}}#h(e){this.dispatchEvent(new o("cue-change",{trigger:e}))}},S=/captions|subtitles/;function M(T){return S.test(T.kind)}function A(T,e,a){let t=h(T)?JSON.parse(T):T,n=[],r=[];return t.regions&&a&&(n=t.regions.map(s=>Object.assign(new a,s))),(t.cues||l(t))&&(r=(l(t)?t:t.cues).filter(s=>c(s.startTime)&&c(s.endTime)).map(s=>Object.assign(new e(0,0,""),s))),{regions:n,cues:r}}export{i as a,C as b,M as c,A as d};
