import{a as w}from"./vidstack-NTONOYHO.js";import{a as h}from"./vidstack-WJVXB6YB.js";import{a as U,b as Ue,c as O,e as Et}from"./vidstack-CJCRVP5A.js";import{a as pe}from"./vidstack-ZYQSM73U.js";import{a as he,c as Lt}from"./vidstack-EV5FVEL6.js";import{a as me}from"./vidstack-IMNMJXWE.js";import{a as v,b as F,c as k}from"./vidstack-4QJFXBXL.js";import{a as Mt,b as Pt}from"./vidstack-HDVJ2P4K.js";import{c as We,i as xt,t as wt}from"./vidstack-SKR3AJXQ.js";import{c as St}from"./vidstack-KCALJS55.js";import{b as V,d as ce}from"./vidstack-BQBKKLOB.js";import{A as kt,a as pt,b as de,c as mt,e as le,g as ft,h as yt,l as gt,m as ue,n as vt,w as Tt,x as bt,y as Z,z as ee}from"./vidstack-4WUVJWEQ.js";import{B as ot,D as dt,F as J,G as Q,I as P,J as ae,L as c,N as lt,T as K,U as N,V as ne,Y as ut,_ as ct,a as u,b as D,c as $,e as st,ea as Ne,f as T,ga as oe,h as Ke,ha as ht,j as at,m as X,n as m,q as A,r as y,w as nt,x as f}from"./vidstack-XC7WIXLW.js";var ti=Symbol(0),H=class a{constructor(e,t,i,r,s){this.logger=e;this.level=t;this.title=i;this.root=r;this.parent=s}[ti]=!0;logs=[];log(...e){return this.logs.push({data:e}),this}labelledLog(e,...t){return this.logs.push({label:e,data:t}),this}groupStart(e){return new a(this.logger,this.level,e,this.root??this,this)}groupEnd(){return this.parent?.logs.push(this),this.parent??this}dispatch(){return this.logger.dispatch(this.level,this.root??this)}};var _t=class{#t=null;error(...e){return this.dispatch("error",...e)}warn(...e){return this.dispatch("warn",...e)}info(...e){return this.dispatch("info",...e)}debug(...e){return this.dispatch("debug",...e)}errorGroup(e){return new H(this,"error",e)}warnGroup(e){return new H(this,"warn",e)}infoGroup(e){return new H(this,"info",e)}debugGroup(e){return new H(this,"debug",e)}setTarget(e){this.#t=e}dispatch(e,...t){return this.#t?.dispatchEvent(new y("vds-log",{bubbles:!0,composed:!0,detail:{level:e,data:t}}))||!1}};var W=class extends nt{items=[];[h.readonly]=!1;get length(){return this.items.length}get readonly(){return this[h.readonly]}indexOf(e){return this.items.indexOf(e)}getById(e){return e===""?null:this.items.find(t=>t.id===e)??null}toArray(){return[...this.items]}[Symbol.iterator](){return this.items.values()}[h.add](e,t){let i=this.items.length;""+i in this||Object.defineProperty(this,i,{get(){return this.items[i]}}),!this.items.includes(e)&&(this.items.push(e),this.dispatchEvent(new y("add",{detail:e,trigger:t})))}[h.remove](e,t){let i=this.items.indexOf(e);i>=0&&(this[h.onRemove]?.(e,t),this.items.splice(i,1),this.dispatchEvent(new y("remove",{detail:e,trigger:t})))}[h.reset](e){for(let t of[...this.items])this[h.remove](t,e);this.items=[],this[h.setReadonly](!1,e),this[h.onReset]?.()}[h.setReadonly](e,t){this[h.readonly]!==e&&(this[h.readonly]=e,this.dispatchEvent(new y("readonly-change",{detail:e,trigger:t})))}};var L={fullscreenEnabled:0,fullscreenElement:1,requestFullscreen:2,exitFullscreen:3,fullscreenchange:4,fullscreenerror:5,fullscreen:6},qt=["webkitFullscreenEnabled","webkitFullscreenElement","webkitRequestFullscreen","webkitExitFullscreen","webkitfullscreenchange","webkitfullscreenerror","-webkit-full-screen"],Rt=["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozfullscreenerror","-moz-full-screen"],Ct=["msFullscreenEnabled","msFullscreenElement","msRequestFullscreen","msExitFullscreen","MSFullscreenChange","MSFullscreenError","-ms-fullscreen"],x=typeof window<"u"&&typeof window.document<"u"?window.document:{},q="fullscreenEnabled"in x&&Object.keys(L)||qt[0]in x&&qt||Rt[0]in x&&Rt||Ct[0]in x&&Ct||[],ii={requestFullscreen:function(a){return a[q[L.requestFullscreen]]()},requestFullscreenFunction:function(a){return a[q[L.requestFullscreen]]},get exitFullscreen(){return x[q[L.exitFullscreen]].bind(x)},get fullscreenPseudoClass(){return":"+q[L.fullscreen]},addEventListener:function(a,e,t){return x.addEventListener(q[L[a]],e,t)},removeEventListener:function(a,e,t){return x.removeEventListener(q[L[a]],e,t)},get fullscreenEnabled(){return!!x[q[L.fullscreenEnabled]]},set fullscreenEnabled(a){},get fullscreenElement(){return x[q[L.fullscreenElement]]},set fullscreenElement(a){},get onfullscreenchange(){return x[("on"+q[L.fullscreenchange]).toLowerCase()]},set onfullscreenchange(a){return x[("on"+q[L.fullscreenchange]).toLowerCase()]=a},get onfullscreenerror(){return x[("on"+q[L.fullscreenerror]).toLowerCase()]},set onfullscreenerror(a){return x[("on"+q[L.fullscreenerror]).toLowerCase()]=a}},R=ii;var fe=R.fullscreenEnabled,ye=class extends K{#t=!1;#e=!1;get active(){return this.#e}get supported(){return fe}onConnect(){f(R,"fullscreenchange",this.#r.bind(this)),f(R,"fullscreenerror",this.#s.bind(this)),T(this.#i.bind(this))}async#i(){fe&&await this.exit()}#r(e){let t=Be(this.el);t!==this.#e&&(t||(this.#t=!1),this.#e=t,this.dispatch("fullscreen-change",{detail:t,trigger:e}))}#s(e){this.#t&&(this.dispatch("fullscreen-error",{detail:null,trigger:e}),this.#t=!1)}async enter(){try{return this.#t=!0,!this.el||Be(this.el)?void 0:($t(),R.requestFullscreen(this.el))}catch(e){throw this.#t=!1,e}}async exit(){if(!(!this.el||!Be(this.el)))return $t(),R.exitFullscreen()}};function ki(){return fe}function Be(a){if(R.fullscreenElement===a)return!0;try{return a.matches(R.fullscreenPseudoClass)}catch{return!1}}function $t(){if(!fe)throw Error("[vidstack] no fullscreen API")}var B=class a extends K{#t=P(this.#n());#e=P(!1);#i;get type(){return this.#t()}get locked(){return this.#e()}get portrait(){return this.#t().startsWith("portrait")}get landscape(){return this.#t().startsWith("landscape")}static supported=le();get supported(){return a.supported}onConnect(){if(this.supported)f(screen.orientation,"change",this.#s.bind(this));else{let e=window.matchMedia("(orientation: landscape)");e.onchange=this.#s.bind(this),T(()=>e.onchange=null)}T(this.#r.bind(this))}async#r(){this.supported&&this.#e()&&await this.unlock()}#s(e){this.#t.set(this.#n()),this.dispatch("orientation-change",{detail:{orientation:u(this.#t),lock:this.#i},trigger:e})}async lock(e){u(this.#e)||this.#i===e||(this.#a(),await screen.orientation.lock(e),this.#e.set(!0),this.#i=e)}async unlock(){u(this.#e)&&(this.#a(),this.#i=void 0,await screen.orientation.unlock(),this.#e.set(!1))}#a(){if(!this.supported)throw Error("[vidstack] no orientation API")}#n(){return this.supported?window.screen.orientation.type:window.innerWidth>=window.innerHeight?"landscape-primary":"portrait-primary"}};function te(a){return!m(a)&&"width"in a&&"height"in a&&X(a.width)&&X(a.height)}var Ye=new ne({artist:"",artwork:null,audioTrack:null,audioTracks:[],autoPlay:!1,autoPlayError:null,audioGain:null,buffered:new U,canLoad:!1,canLoadPoster:!1,canFullscreen:!1,canOrientScreen:le(),canPictureInPicture:!1,canPlay:!1,clipStartTime:0,clipEndTime:0,controls:!1,get iOSControls(){return de&&this.mediaType==="video"&&(!this.playsInline||!R.fullscreenEnabled&&this.fullscreen)},get nativeControls(){return this.controls||this.iOSControls},controlsVisible:!1,get controlsHidden(){return!this.controlsVisible},crossOrigin:null,ended:!1,error:null,fullscreen:!1,get loop(){return this.providedLoop||this.userPrefersLoop},logLevel:"silent",mediaType:"unknown",muted:!1,paused:!0,played:new U,playing:!1,playsInline:!1,pictureInPicture:!1,preload:"metadata",playbackRate:1,qualities:[],quality:null,autoQuality:!1,canSetQuality:!0,canSetPlaybackRate:!0,canSetVolume:!1,canSetAudioGain:!1,seekable:new U,seeking:!1,source:{src:"",type:""},sources:[],started:!1,textTracks:[],textTrack:null,get hasCaptions(){return this.textTracks.filter(k).length>0},volume:1,waiting:!1,realCurrentTime:0,get currentTime(){return this.ended?this.duration:this.clipStartTime>0?Math.max(0,Math.min(this.realCurrentTime-this.clipStartTime,this.duration)):this.realCurrentTime},providedDuration:-1,intrinsicDuration:0,get realDuration(){return this.providedDuration>0?this.providedDuration:this.intrinsicDuration},get duration(){return this.clipEndTime>0?this.clipEndTime-this.clipStartTime:Math.max(0,this.realDuration-this.clipStartTime)},get title(){return this.providedTitle||this.inferredTitle},get poster(){return this.providedPoster||this.inferredPoster},get viewType(){return this.providedViewType!=="unknown"?this.providedViewType:this.inferredViewType},get streamType(){return this.providedStreamType!=="unknown"?this.providedStreamType:this.inferredStreamType},get currentSrc(){return this.source},get bufferedStart(){let a=Ue(this.buffered)??0;return Math.max(0,a-this.clipStartTime)},get bufferedEnd(){let a=O(this.buffered)??0;return Math.min(this.duration,Math.max(0,a-this.clipStartTime))},get seekableStart(){let a=Ue(this.seekable)??0;return Math.max(0,a-this.clipStartTime)},get seekableEnd(){let a=this.canPlay?O(this.seekable)??1/0:0;return this.clipEndTime>0?Math.max(this.clipEndTime,Math.max(0,a-this.clipStartTime)):a},get seekableWindow(){return Math.max(0,this.seekableEnd-this.seekableStart)},canAirPlay:!1,canGoogleCast:!1,remotePlaybackState:"disconnected",remotePlaybackType:"none",remotePlaybackLoader:null,remotePlaybackInfo:null,get isAirPlayConnected(){return this.remotePlaybackType==="airplay"&&this.remotePlaybackState==="connected"},get isGoogleCastConnected(){return this.remotePlaybackType==="google-cast"&&this.remotePlaybackState==="connected"},pointer:"fine",orientation:"landscape",width:0,height:0,mediaWidth:0,mediaHeight:0,lastKeyboardAction:null,userBehindLiveEdge:!1,liveEdgeTolerance:10,minLiveDVRWindow:60,get canSeek(){return/unknown|on-demand|:dvr/.test(this.streamType)&&Number.isFinite(this.seekableWindow)&&(!this.live||/:dvr/.test(this.streamType)&&this.seekableWindow>=this.minLiveDVRWindow)},get live(){return this.streamType.includes("live")||!Number.isFinite(this.realDuration)},get liveEdgeStart(){return this.live&&Number.isFinite(this.seekableEnd)?Math.max(0,(this.liveSyncPosition??this.seekableEnd)-this.liveEdgeTolerance):0},get liveEdge(){return this.live&&(!this.canSeek||!this.userBehindLiveEdge&&this.currentTime>=this.liveEdgeStart)},get liveEdgeWindow(){return this.live&&Number.isFinite(this.seekableEnd)?this.seekableEnd-this.liveEdgeStart:0},autoPlaying:!1,providedTitle:"",inferredTitle:"",providedLoop:!1,userPrefersLoop:!1,providedPoster:"",inferredPoster:"",inferredViewType:"unknown",providedViewType:"unknown",providedStreamType:"unknown",inferredStreamType:"unknown",liveSyncPosition:null,savedState:null}),At=new Set(["autoPlayError","autoPlaying","buffered","canPlay","error","paused","played","playing","seekable","seeking","waiting"]),ri=new Set([...At,"ended","inferredPoster","inferredStreamType","inferredTitle","intrinsicDuration","liveSyncPosition","realCurrentTime","savedState","started","userBehindLiveEdge"]);function ze(a,e=!1){let t=e?At:ri;Ye.reset(a,i=>t.has(i)),$()}var ge=class{#t=null;#e=null;#i=-1;#r;constructor(e=void 0){this.#r=e}setTarget(e){this.#t=e}getPlayer(e){return this.#e?this.#e:((e??this.#t)?.dispatchEvent(new y("find-media-player",{detail:t=>void(this.#e=t),bubbles:!0,composed:!0})),this.#e)}setPlayer(e){this.#e=e}startLoading(e){this.#s("media-start-loading",e)}startLoadingPoster(e){this.#s("media-poster-start-loading",e)}requestAirPlay(e){this.#s("media-airplay-request",e)}requestGoogleCast(e){this.#s("media-google-cast-request",e)}play(e){this.#s("media-play-request",e)}pause(e){this.#s("media-pause-request",e)}mute(e){this.#s("media-mute-request",e)}unmute(e){this.#s("media-unmute-request",e)}enterFullscreen(e,t){this.#s("media-enter-fullscreen-request",t,e)}exitFullscreen(e,t){this.#s("media-exit-fullscreen-request",t,e)}lockScreenOrientation(e,t){this.#s("media-orientation-lock-request",t,e)}unlockScreenOrientation(e){this.#s("media-orientation-unlock-request",e)}enterPictureInPicture(e){this.#s("media-enter-pip-request",e)}exitPictureInPicture(e){this.#s("media-exit-pip-request",e)}seeking(e,t){this.#s("media-seeking-request",t,e)}seek(e,t){this.#s("media-seek-request",t,e)}seekToLiveEdge(e){this.#s("media-live-edge-request",e)}changeDuration(e,t){this.#s("media-duration-change-request",t,e)}changeClipStart(e,t){this.#s("media-clip-start-change-request",t,e)}changeClipEnd(e,t){this.#s("media-clip-end-change-request",t,e)}changeVolume(e,t){this.#s("media-volume-change-request",t,Math.max(0,Math.min(1,e)))}changeAudioTrack(e,t){this.#s("media-audio-track-change-request",t,e)}changeQuality(e,t){this.#s("media-quality-change-request",t,e)}requestAutoQuality(e){this.changeQuality(-1,e)}changeTextTrackMode(e,t,i){this.#s("media-text-track-change-request",i,{index:e,mode:t})}changePlaybackRate(e,t){this.#s("media-rate-change-request",t,e)}changeAudioGain(e,t){this.#s("media-audio-gain-change-request",t,e)}resumeControls(e){this.#s("media-resume-controls-request",e)}pauseControls(e){this.#s("media-pause-controls-request",e)}togglePaused(e){let t=this.getPlayer(e?.target);t&&(t.state.paused?this.play(e):this.pause(e))}toggleControls(e){let t=this.getPlayer(e?.target);t&&(t.controls.showing?t.controls.hide(0,e):t.controls.show(0,e))}toggleMuted(e){let t=this.getPlayer(e?.target);t&&(t.state.muted?this.unmute(e):this.mute(e))}toggleFullscreen(e,t){let i=this.getPlayer(t?.target);i&&(i.state.fullscreen?this.exitFullscreen(e,t):this.enterFullscreen(e,t))}togglePictureInPicture(e){let t=this.getPlayer(e?.target);t&&(t.state.pictureInPicture?this.exitPictureInPicture(e):this.enterPictureInPicture(e))}showCaptions(e){let t=this.getPlayer(e?.target);if(!t)return;let i=t.state.textTracks,r=this.#i;(!i[r]||!k(i[r]))&&(r=-1),r===-1&&(r=i.findIndex(s=>k(s)&&s.default)),r===-1&&(r=i.findIndex(s=>k(s))),r>=0&&this.changeTextTrackMode(r,"showing",e),this.#i=-1}disableCaptions(e){let t=this.getPlayer(e?.target);if(!t)return;let i=t.state.textTracks,r=t.state.textTrack;if(r){let s=i.indexOf(r);this.changeTextTrackMode(s,"disabled",e),this.#i=s}}toggleCaptions(e){let t=this.getPlayer(e?.target);t&&(t.state.textTrack?this.disableCaptions():this.showCaptions())}userPrefersLoopChange(e,t){this.#s("media-user-loop-change-request",t,e)}#s(e,t,i){let r=new y(e,{bubbles:!0,composed:!0,cancelable:!0,detail:i,trigger:t}),s=t?.target||null;s&&s instanceof N&&(s=s.el),s=!s||s===document||s===window||s===document.body||this.#e?.el&&s instanceof Node&&!this.#e.el.contains(s)?this.#t??this.getPlayer()?.el:s??this.#t,this.#e?e==="media-play-request"&&!this.#e.state.canLoad?s?.dispatchEvent(r):this.#e.canPlayQueue.enqueue(e,()=>s?.dispatchEvent(r)):s?.dispatchEvent(r)}#a(e){}};var ve=class{playerId="vds-player";mediaId=null;#t={volume:null,muted:null,audioGain:null,time:null,lang:null,captions:null,rate:null,quality:null};async getVolume(){return this.#t.volume}async setVolume(e){this.#t.volume=e,this.save()}async getMuted(){return this.#t.muted}async setMuted(e){this.#t.muted=e,this.save()}async getTime(){return this.#t.time}async setTime(e,t){let i=e<0;this.#t.time=i?null:e,i||t?this.saveTime():this.saveTimeThrottled()}async getLang(){return this.#t.lang}async setLang(e){this.#t.lang=e,this.save()}async getCaptions(){return this.#t.captions}async setCaptions(e){this.#t.captions=e,this.save()}async getPlaybackRate(){return this.#t.rate}async setPlaybackRate(e){this.#t.rate=e,this.save()}async getAudioGain(){return this.#t.audioGain}async setAudioGain(e){this.#t.audioGain=e,this.save()}async getVideoQuality(){return this.#t.quality}async setVideoQuality(e){this.#t.quality=e,this.save()}onChange(e,t,i="vds-player"){let r=i?localStorage.getItem(i):null,s=t?localStorage.getItem(t):null;this.playerId=i,this.mediaId=t,this.#t={volume:null,muted:null,audioGain:null,lang:null,captions:null,rate:null,quality:null,...r?JSON.parse(r):{},time:s?+s:null}}save(){if(!this.playerId)return;let e=JSON.stringify({...this.#t,time:void 0});localStorage.setItem(this.playerId,e)}saveTimeThrottled=he(this.saveTime.bind(this),1e3);saveTime(){if(!this.mediaId)return;let e=(this.#t.time??0).toString();localStorage.setItem(this.mediaId,e)}};var Ee=class{priority=0;#t=!0;#e=null;#i=null;#r=new Set;canRender(e,t){return!!t}attach(e){this.#e=e,e&&(e.textTracks.onchange=this.#l.bind(this))}addTrack(e){this.#r.add(e),this.#s(e)}removeTrack(e){e[v.native]?.remove?.(),e[v.native]=null,this.#r.delete(e)}changeTrack(e){let t=e?.[v.native];t&&t.track.mode!=="showing"&&(t.track.mode="showing"),this.#i=e}setDisplay(e){this.#t=e,this.#l()}detach(){this.#e&&(this.#e.textTracks.onchange=null);for(let e of this.#r)this.removeTrack(e);this.#r.clear(),this.#e=null,this.#i=null}#s(e){if(!this.#e)return;let t=e[v.native]??=this.#a(e);wt(t)&&(this.#e.append(t),t.track.mode=t.default?"showing":"disabled")}#a(e){let t=document.createElement("track"),i=e.default||e.mode==="showing",r=e.src&&e.type==="vtt";return t.id=e.id,t.src=r?e.src:"",t.label=e.label,t.kind=e.kind,t.default=i,e.language&&(t.srclang=e.language),i&&!r&&this.#n(e,t.track),t}#n(e,t){if(!(e.src&&e.type==="vtt"||t.cues?.length))for(let i of e.cues)t.addCue(i)}#l(e){for(let t of this.#r){let i=t[v.native];if(!i)continue;if(!this.#t){i.track.mode=i.managed?"hidden":"disabled";continue}let r=i.track.mode==="showing";r&&this.#n(t,i.track),t.setMode(r?"showing":"disabled",e)}}};var Te=class{#t=null;#e;#i=[];#r;#s=!1;#a=null;#n=null;constructor(e){this.#r=e;let t=e.textTracks;this.#e=t,c(this.#l.bind(this)),T(this.#p.bind(this)),f(t,"add",this.#h.bind(this)),f(t,"remove",this.#u.bind(this)),f(t,"mode-change",this.#o.bind(this))}#l(){let{nativeControls:e}=this.#r.$state;this.#s=e(),this.#o()}add(e){this.#i.push(e),D(this.#o.bind(this))}remove(e){e.detach(),this.#i.splice(this.#i.indexOf(e),1),D(this.#o.bind(this))}attachVideo(e){requestAnimationFrame(()=>{if(this.#t=e,e){this.#a=new Ee,this.#a.attach(e);for(let t of this.#e)this.#d(t)}this.#o()})}#d(e){k(e)&&this.#a?.addTrack(e)}#c(e){k(e)&&this.#a?.removeTrack(e)}#h(e){this.#d(e.detail)}#u(e){this.#c(e.detail)}#o(){let e=this.#e.selected;if(this.#t&&(this.#s||e?.[v.nativeHLS])){this.#n?.changeTrack(null),this.#a?.setDisplay(!0),this.#a?.changeTrack(e);return}if(this.#a?.setDisplay(!1),this.#a?.changeTrack(null),!e){this.#n?.changeTrack(null);return}let t=this.#i.sort((i,r)=>i.priority-r.priority).find(i=>i.canRender(e,this.#t));this.#n!==t&&(this.#n?.detach(),t?.attach(this.#t),this.#n=t??null),t?.changeTrack(e)}#p(){this.#a?.detach(),this.#a=null,this.#n?.detach(),this.#n=null}};var be=class extends W{#t=!1;#e={};#i=null;#r=null;[v.crossOrigin];constructor(){super()}get selected(){return this.items.find(t=>t.mode==="showing"&&k(t))??null}get selectedIndex(){let e=this.selected;return e?this.indexOf(e):-1}get preferredLang(){return this.#r}set preferredLang(e){this.#r=e,this.#c(e)}add(e,t){let i=e instanceof F,r=i?e:new F(e),s=e.kind==="captions"||e.kind==="subtitles"?"captions":e.kind;return this.#e[s]&&e.default&&delete e.default,r.addEventListener("mode-change",this.#n),this[h.add](r,t),r[v.crossOrigin]=this[v.crossOrigin],this.#t&&r[v.canLoad](),e.default&&(this.#e[s]=r),this.#s(),this}remove(e,t){if(this.#a=e,!!this.items.includes(e))return e===this.#e[e.kind]&&delete this.#e[e.kind],e.mode="disabled",e[v.onModeChange]=null,e.removeEventListener("mode-change",this.#n),this[h.remove](e,t),this.#a=null,this}clear(e){for(let t of[...this.items])this.remove(t,e);return this}getByKind(e){let t=Array.isArray(e)?e:[e];return this.items.filter(i=>t.includes(i.kind))}[v.canLoad](){if(!this.#t){for(let e of this.items)e[v.canLoad]();this.#t=!0,this.#s()}}#s=pe(async()=>{if(!this.#t)return;!this.#r&&this.#i&&(this.#r=await this.#i.getLang());let e=await this.#i?.getCaptions(),t=[["captions","subtitles"],"chapters","descriptions","metadata"];for(let i of t){let r=this.getByKind(i);if(r.find(l=>l.mode==="showing"))continue;let s=this.#r?r.find(l=>l.language===this.#r):null,n=A(i)?this.#e[i.find(l=>this.#e[l])||""]:this.#e[i],o=s??n,d=o&&k(o);o&&(!d||e!==!1)&&(o.mode="showing",d&&this.#d(o))}},300);#a=null;#n=this.#l.bind(this);#l(e){let t=e.detail;if(this.#i&&k(t)&&t!==this.#a&&this.#d(t),t.mode==="showing"){let i=k(t)?["captions","subtitles"]:[t.kind];for(let r of this.items)r.mode==="showing"&&r!=t&&i.includes(r.kind)&&(r.mode="disabled")}this.dispatchEvent(new y("mode-change",{detail:e.detail,trigger:e}))}#d(e){e.mode!=="disabled"&&this.#c(e.language),this.#i?.setCaptions?.(e.mode==="showing")}#c(e){this.#i?.setLang?.(this.#r=e)}setStorage(e){this.#i=e}};var ie=Symbol(0),Y=class extends W{get selected(){return this.items.find(e=>e.selected)??null}get selectedIndex(){return this.items.findIndex(e=>e.selected)}[h.onRemove](e,t){this[h.select](e,!1,t)}[h.add](e,t){e[ie]=!1,Object.defineProperty(e,"selected",{get(){return this[ie]},set:i=>{this.readonly||(this[h.onUserSelect]?.(),this[h.select](e,i))}}),super[h.add](e,t)}[h.select](e,t,i){if(t===e?.[ie])return;let r=this.selected;e&&(e[ie]=t),(t?r!==e:r===e)&&(r&&(r[ie]=!1),this.dispatchEvent(new y("change",{detail:{prev:r,current:this.selected},trigger:i})))}};var ke=class extends Y{};var Me=class extends Y{#t=!1;switch="current";get auto(){return this.#t||this.readonly}[w.enableAuto];[h.onUserSelect](){this[w.setAuto](!1)}[h.onReset](e){this[w.enableAuto]=void 0,this[w.setAuto](!1,e)}autoSelect(e){this.readonly||this.#t||!this[w.enableAuto]||(this[w.enableAuto]?.(e),this[w.setAuto](!0,e))}getBySrc(e){return this.items.find(t=>t.src===e)}[w.setAuto](e,t){this.#t!==e&&(this.#t=e,this.dispatchEvent(new y("auto-change",{detail:e,trigger:t})))}};function yr(a){return a?.$$PROVIDER_TYPE==="AUDIO"}function gr(a){return a?.$$PROVIDER_TYPE==="VIDEO"}function vr(a){return a?.$$PROVIDER_TYPE==="HLS"}function Er(a){return a?.$$PROVIDER_TYPE==="DASH"}function Tr(a){return a?.$$PROVIDER_TYPE==="YOUTUBE"}function br(a){return a?.$$PROVIDER_TYPE==="VIMEO"}function kr(a){return a?.$$PROVIDER_TYPE==="GOOGLE_CAST"}function si(a){return a instanceof HTMLAudioElement}function ai(a){return a instanceof HTMLVideoElement}function Vt(a){return si(a)||ai(a)}function Mr(a){return a instanceof HTMLIFrameElement}var M=class extends K{};var Dt={togglePaused:"k Space",toggleMuted:"m",toggleFullscreen:"f",togglePictureInPicture:"i",toggleCaptions:"c",seekBackward:"j J ArrowLeft",seekForward:"l L ArrowRight",volumeUp:"ArrowUp",volumeDown:"ArrowDown",speedUp:">",slowDown:"<"},Pe=new Set(["Shift","Alt","Meta","Ctrl"]),ni='button, [role="button"]',It='input, textarea, select, [contenteditable], [role^="menuitem"], [role="timer"]',Se=class extends M{#t;constructor(e){super(),this.#t=e}onConnect(){c(this.#e.bind(this))}#e(){let{keyDisabled:e,keyTarget:t}=this.$props;if(e())return;let i=t()==="player"?this.el:document,r=P(!1);i===this.el?(this.listen("focusin",()=>r.set(!0)),this.listen("focusout",s=>{this.el.contains(s.target)||r.set(!1)})):(u(r)||r.set(document.querySelector("[data-media-player]")===this.el),f(document,"focusin",s=>{let n=s.composedPath().find(o=>o instanceof Element&&o.localName==="media-player");n!==void 0&&r.set(this.el===n)})),c(()=>{r()&&(f(i,"keyup",this.#i.bind(this)),f(i,"keydown",this.#r.bind(this)),f(i,"keydown",this.#s.bind(this),{capture:!0}))})}#i(e){let t=document.activeElement;if(!e.key||!this.$state.canSeek()||t?.matches(It))return;let{method:i,value:r}=this.#a(e);if(!m(r)&&!A(r)){r?.onKeyUp?.({event:e,player:this.#t.player,remote:this.#t.remote}),r?.callback?.(e,this.#t.remote);return}i?.startsWith("seek")&&(e.preventDefault(),e.stopPropagation(),this.#d?(this.#c(e,i==="seekForward"),this.#d=null):(this.#t.remote.seek(this.#n,e),this.#n=void 0)),i?.startsWith("volume")&&this.el.querySelector("[data-media-volume-slider]")?.dispatchEvent(new KeyboardEvent("keyup",{key:i==="volumeUp"?"Up":"Down",shiftKey:e.shiftKey,trigger:e}))}#r(e){if(!e.key||Pe.has(e.key))return;let t=document.activeElement;if(t?.matches(It)||dt(e)&&t?.matches(ni))return;let{method:i,value:r}=this.#a(e),s=!e.metaKey&&/^[0-9]$/.test(e.key);if(!m(r)&&!A(r)&&!s){r?.onKeyDown?.({event:e,player:this.#t.player,remote:this.#t.remote}),r?.callback?.(e,this.#t.remote);return}if(!i&&s){e.preventDefault(),e.stopPropagation(),this.#t.remote.seek(this.$state.duration()/10*Number(e.key),e);return}if(i){switch(e.preventDefault(),e.stopPropagation(),i){case"seekForward":case"seekBackward":this.#h(e,i,i==="seekForward");break;case"volumeUp":case"volumeDown":let n=this.el.querySelector("[data-media-volume-slider]");if(n)n.dispatchEvent(new KeyboardEvent("keydown",{key:i==="volumeUp"?"Up":"Down",shiftKey:e.shiftKey,trigger:e}));else{let d=e.shiftKey?.1:.05;this.#t.remote.changeVolume(this.$state.volume()+(i==="volumeUp"?+d:-d),e)}break;case"toggleFullscreen":this.#t.remote.toggleFullscreen("prefer-media",e);break;case"speedUp":case"slowDown":let o=this.$state.playbackRate();this.#t.remote.changePlaybackRate(Math.max(.25,Math.min(2,o+(i==="speedUp"?.25:-.25))),e);break;default:this.#t.remote[i]?.(e)}this.$state.lastKeyboardAction.set({action:i,event:e})}}#s(e){Vt(e.target)&&this.#a(e).method&&e.preventDefault()}#a(e){let t={...this.$props.keyShortcuts(),...this.#t.ariaKeys},i=Object.keys(t).find(r=>{let s=t[r],n=A(s)?s.join(" "):m(s)?s:s?.keys;return(A(n)?n:n?.split(" "))?.map(d=>di(d).replace(/Control/g,"Ctrl").split("+"))?.some(d=>{let l=new Set(d.filter(p=>Pe.has(p)));for(let p of Pe){let b=p.toLowerCase()+"Key";if(!l.has(p)&&e[b])return!1}return d.every(p=>Pe.has(p)?e[p.toLowerCase()+"Key"]:e.key===p.replace("Space"," "))})});return{method:i,value:i?t[i]:null}}#n;#l(e,t){let i=e.shiftKey?10:5;return this.#n=Math.max(0,Math.min((this.#n??this.$state.currentTime())+(t==="seekForward"?+i:-i),this.$state.duration()))}#d=null;#c(e,t){this.#d?.dispatchEvent(new KeyboardEvent(e.type,{key:t?"Right":"Left",shiftKey:e.shiftKey,trigger:e}))}#h(e,t,i){this.$state.canSeek()&&(this.#d||(this.#d=this.el.querySelector("[data-media-time-slider]")),this.#d?this.#c(e,i):this.#t.remote.seeking(this.#l(e,t),e))}},oi=["!","@","#","$","%","^","&","*","(",")"];function di(a){return a.replace(/Shift\+(\d)/g,(e,t)=>oi[t-1])}var xe=class extends M{#t=-2;#e=!1;#i=P(!1);#r=P(!1);#s=null;#a=P(!0);defaultDelay=2e3;get canIdle(){return this.#a()}set canIdle(e){this.#a.set(e)}get hideOnMouseLeave(){let{hideControlsOnMouseLeave:e}=this.$props;return this.#i()||e()}set hideOnMouseLeave(e){this.#i.set(e)}get showing(){return this.$state.controlsVisible()}show(e=0,t){this.#p(),this.#e||this.#f(!0,e,t)}hide(e=this.defaultDelay,t){this.#p(),this.#e||this.#f(!1,e,t)}pause(e){this.#e=!0,this.#p(),this.#f(!0,0,e)}resume(e){this.#e=!1,!this.$state.paused()&&this.#f(!1,this.defaultDelay,e)}onConnect(){c(this.#n.bind(this))}#n(){let{viewType:e}=this.$state;if(!this.#a())return;if(e()==="audio"){this.show();return}c(this.#l.bind(this)),c(this.#d.bind(this));let t=this.#c.bind(this),i=this.#h.bind(this);this.listen("can-play",r=>this.show(0,r)),this.listen("play",t),this.listen("pause",i),this.listen("auto-play-fail",i)}#l(){let{started:e,pointer:t,paused:i}=this.$state;if(!e()||t()!=="fine")return;let r=this.hideOnMouseLeave;(!r||!this.#r())&&c(()=>{i()||this.listen("pointermove",this.#y.bind(this))}),r&&(this.listen("mouseenter",this.#u.bind(this)),this.listen("mouseleave",this.#o.bind(this)))}#d(){let{paused:e,started:t,autoPlayError:i}=this.$state;if(e()||i()&&!t())return;let r=this.#y.bind(this);c(()=>{let s=this.$state.pointer(),n=s==="coarse",o=[n?"touchend":"pointerup","keydown"];for(let d of o)this.listen(d,r,{passive:!1})})}#c(e){this.show(0,e),this.hide(void 0,e)}#h(e){this.show(0,e)}#u(e){this.#r.set(!1),this.show(0,e),this.hide(void 0,e)}#o(e){this.#r.set(!0),this.hide(0,e)}#p(){window.clearTimeout(this.#t),this.#t=-1}#y(e){e.MEDIA_GESTURE||this.#e||xt(e)||(ot(e)&&(e.key==="Escape"?(this.el?.focus(),this.#s=null):this.#s&&(e.preventDefault(),requestAnimationFrame(()=>{this.#s?.focus(),this.#s=null}))),this.show(0,e),this.hide(this.defaultDelay,e))}#f(e,t,i){if(t===0){this.#m(e,i);return}this.#t=window.setTimeout(()=>{this.scope&&this.#m(e&&!this.#e,i)},t)}#m(e,t){this.$state.controlsVisible()!==e&&(this.$state.controlsVisible.set(e),!e&&document.activeElement&&this.el?.contains(document.activeElement)&&(this.#s=document.activeElement,requestAnimationFrame(()=>{this.el?.focus({preventScroll:!0})})),this.dispatch("controls-change",{detail:e,trigger:t}))}};var we=class{name="audio";target;canPlay(e){return Tt(e)?!m(e.src)||e.type==="?"||ft(this.target,e.type):!1}mediaType(){return"audio"}async load(e){return new(await import("../providers/vidstack-audio.js")).AudioProvider(this.target,e)}};var I=class{name="video";target;canPlay(e){return bt(e)?!m(e.src)||e.type==="?"||yt(this.target,e.type):!1}mediaType(){return"video"}async load(e){return new(await import("../providers/vidstack-video.js")).VideoProvider(this.target,e)}};var Le=class a extends I{static supported=ue();name="hls";canPlay(e){return a.supported&&Z(e)}async load(e){return new(await import("../providers/vidstack-hls.js")).HLSProvider(this.target,e)}};var _e=class a extends I{static supported=vt();name="dash";canPlay(e){return a.supported&&ee(e)}async load(e){return new(await import("../providers/vidstack-dash.js")).DASHProvider(this.target,e)}};var qe=class{name="vimeo";target;preconnect(){let e=["https://i.vimeocdn.com","https://f.vimeocdn.com","https://fresnel.vimeocdn.com"];for(let t of e)V(t)}canPlay(e){return m(e.src)&&e.type==="video/vimeo"}mediaType(){return"video"}async load(e){return new(await import("../providers/vidstack-vimeo.js")).VimeoProvider(this.target,e)}async loadPoster(e,t,i){let{resolveVimeoVideoId:r,getVimeoVideoInfo:s}=await import("./vidstack-JUYOWWVN.js");if(!m(e.src))return null;let{videoId:n,hash:o}=r(e.src);return n?s(n,i,o).then(d=>d?d.poster:null):null}};var Re=class{name="youtube";target;preconnect(){let e=["https://www.google.com","https://i.ytimg.com","https://googleads.g.doubleclick.net","https://static.doubleclick.net"];for(let t of e)V(t)}canPlay(e){return m(e.src)&&e.type==="video/youtube"}mediaType(){return"video"}async load(e){return new(await import("../providers/vidstack-youtube.js")).YouTubeProvider(this.target,e)}async loadPoster(e,t,i){let{findYouTubePoster:r,resolveYouTubeVideoId:s}=await import("./vidstack-PK326JNQ.js"),n=m(e.src)&&s(e.src);return n?r(n,i):null}};var Ce=Symbol(0),Ot=["autoPlay","canAirPlay","canFullscreen","canGoogleCast","canLoad","canLoadPoster","canPictureInPicture","canPlay","canSeek","ended","fullscreen","isAirPlayConnected","isGoogleCastConnected","live","liveEdge","loop","mediaType","muted","paused","pictureInPicture","playing","playsInline","remotePlaybackState","remotePlaybackType","seeking","started","streamType","viewType","waiting"];var Ft={artist:"",artwork:null,autoplay:!1,autoPlay:!1,clipStartTime:0,clipEndTime:0,controls:!1,currentTime:0,crossorigin:null,crossOrigin:null,duration:-1,fullscreenOrientation:"landscape",googleCast:{},load:"visible",posterLoad:"visible",logLevel:"silent",loop:!1,muted:!1,paused:!0,playsinline:!1,playsInline:!1,playbackRate:1,poster:"",preload:"metadata",preferNativeHLS:!1,src:"",title:"",controlsDelay:2e3,hideControlsOnMouseLeave:!1,viewType:"unknown",streamType:"unknown",volume:1,liveEdgeTolerance:10,minLiveDVRWindow:60,keyDisabled:!1,keyTarget:"player",keyShortcuts:Dt,storage:null};var re=class extends M{#t;#e;constructor(e,t){super(),this.#t=e,this.#e=t}async onAttach(e){let t=this.$props[this.#t]();if(t==="eager")requestAnimationFrame(this.#e);else if(t==="idle")ht(this.#e);else if(t==="visible"){let i,r=new IntersectionObserver(s=>{this.scope&&s[0].isIntersecting&&(i?.(),i=void 0,this.#e())});r.observe(e),i=T(()=>r.disconnect())}}};var $e=class{#t;#e;constructor(e,t){this.#t=e,this.#e=t}notify(e,...t){this.#t(new y(e,{detail:t?.[0],trigger:t?.[1]}))}async ready(e,t){return D(async()=>{let{logger:i}=this.#e,{autoPlay:r,canPlay:s,started:n,duration:o,seekable:d,buffered:l,remotePlaybackInfo:p,playsInline:b,savedState:E,source:g}=this.#e.$state;if(s())return;let S={duration:e?.duration??o(),seekable:e?.seekable??d(),buffered:e?.buffered??l(),provider:this.#e.$provider()};this.notify("can-play",S,t),$();let _=this.#e.$provider(),{storage:C,qualities:Ze}=this.#e,{muted:zt,volume:jt,clipStartTime:Xt,playbackRate:Jt}=this.#e.$props;await C?.onLoad?.(g());let Zt=E()?.currentTime,et=E()?.paused,Qe=await C?.getTime(),tt=Zt??Qe??Xt(),ei=et||et!==!1&&!n()&&r();if(_){_.setVolume(await C?.getVolume()??jt()),_.setMuted(zt()||!!await C?.getMuted());let G=await C?.getAudioGain()??1;G>1&&_.audioGain?.setGain?.(G),_.setPlaybackRate?.(await C?.getPlaybackRate()??Jt()),_.setPlaysInline?.(b()),tt>0&&_.setCurrentTime(tt)}let j=await C?.getVideoQuality();if(j&&Ze.length){let G=null,it=1/0;for(let se of Ze){let rt=Math.abs(j.width-se.width)+Math.abs(j.height-se.height)+(j.bitrate?Math.abs(j.bitrate-(se.bitrate??0)):0);rt<it&&(G=se,it=rt)}G&&(G.selected=!0)}s()&&ei?await this.#i(t):Qe&&Qe>0&&this.notify("started",void 0,t),p.set(null)})}async#i(e){let{player:t,$state:{autoPlaying:i,muted:r}}=this.#e;i.set(!0);let s=new y("auto-play-attempt",{trigger:e});try{await t.play(s)}catch{}}};var Ae=class{#t=new Map;enqueue(e,t){this.#t.set(e,t)}serve(e){let t=this.peek(e);return this.#t.delete(e),t}peek(e){return this.#t.get(e)}delete(e){this.#t.delete(e)}clear(){this.#t.clear()}};var z=class{#t=!1;#e=Ne();#i=new Map;get size(){return this.#i.size}get isServing(){return this.#t}async waitForFlush(){this.#t||await this.#e.promise}enqueue(e,t){if(this.#t){t();return}this.#i.delete(e),this.#i.set(e,t)}serve(e){this.#i.get(e)?.(),this.#i.delete(e)}start(){this.#r(),this.#t=!0,this.#i.size>0&&this.#r()}stop(){this.#t=!1}reset(){this.stop(),this.#i.clear(),this.#s()}#r(){for(let e of this.#i.keys())this.serve(e);this.#s()}#s(){this.#e.resolve(),this.#e=Ne()}};var Ve=class extends M{#t;#e;#i;controls;#r;#s;#a;#n=new z;constructor(e,t,i){super(),this.#t=e,this.#e=t,this.#i=i,this.#a=i.$provider,this.controls=new xe,this.#r=new ye,this.#s=new B}onAttach(){this.listen("fullscreen-change",this.#M.bind(this))}onConnect(){let e=Object.getOwnPropertyNames(Object.getPrototypeOf(this)),t=this.#c.bind(this);for(let i of e)i.startsWith("media-")&&this.listen(i,t);this.#l(),c(this.#d.bind(this)),c(this.#y.bind(this)),c(this.#f.bind(this)),c(this.#m.bind(this)),c(this.#b.bind(this)),c(this.#E.bind(this)),c(this.#k.bind(this))}onDestroy(){try{let e=this.createEvent("destroy"),{pictureInPicture:t,fullscreen:i}=this.$state;i()&&this.exitFullscreen("prefer-media",e),t()&&this.exitPictureInPicture(e)}catch{}this.#n.reset()}#l(){let{load:e}=this.$props,{canLoad:t}=this.$state;if(e()!=="play"||t())return;let i=this.listen("media-play-request",r=>{this.#h(r),i()})}#d(){let e=this.#a(),t=this.$state.canPlay();return e&&t&&this.#n.start(),()=>{this.#n.stop()}}#c(e){e.stopPropagation(),!e.defaultPrevented&&this[e.type]&&(u(this.#a)?this[e.type](e):this.#n.enqueue(e.type,()=>{u(this.#a)&&this[e.type](e)}))}async play(e){let{canPlay:t,paused:i,autoPlaying:r}=this.$state;if(this.#h(e)||!u(i))return;e&&this.#e.queue.enqueue("media-play-request",e);let s=u(r);try{let n=u(this.#a);return je(n,u(t)),await n.play()}catch(n){let o=this.createEvent("play-fail",{detail:me(n),trigger:e});throw o.autoPlay=s,this.#t.handle(o),n}}#h(e){let{load:t}=this.$props,{canLoad:i}=this.$state;if(t()==="play"&&!i()){let r=this.createEvent("media-start-loading",{trigger:e});return this.dispatchEvent(r),this.#n.enqueue("media-play-request",async()=>{try{await this.play(r)}catch{}}),!0}return!1}async pause(e){let{canPlay:t,paused:i}=this.$state;if(!u(i)){e&&this.#e.queue.enqueue("media-pause-request",e);try{let r=u(this.#a);return je(r,u(t)),await r.pause()}catch(r){throw this.#e.queue.delete("media-pause-request"),r}}}setAudioGain(e,t){let{audioGain:i,canSetAudioGain:r}=this.$state;if(i()===e)return;let s=this.#a();if(!s?.audioGain||!r())throw Error("[vidstack] audio gain api not available");t&&this.#e.queue.enqueue("media-audio-gain-change-request",t),s.audioGain.setGain(e)}seekToLiveEdge(e){let{canPlay:t,live:i,liveEdge:r,canSeek:s,liveSyncPosition:n,seekableEnd:o,userBehindLiveEdge:d}=this.$state;if(d.set(!1),u(()=>!i()||r()||!s()))return;let l=u(this.#a);je(l,u(t)),e&&this.#e.queue.enqueue("media-seek-request",e);let p=o()-2;l.setCurrentTime(Math.min(p,n()??p))}#u=!1;async enterFullscreen(e="prefer-media",t){let i=this.#o(e);if(Ht(e,i),!i.active)return u(this.$state.pictureInPicture)&&(this.#u=!0,await this.exitPictureInPicture(t)),t&&this.#e.queue.enqueue("media-enter-fullscreen-request",t),i.enter()}async exitFullscreen(e="prefer-media",t){let i=this.#o(e);if(Ht(e,i),!!i.active){t&&this.#e.queue.enqueue("media-exit-fullscreen-request",t);try{let r=await i.exit();return this.#u&&u(this.$state.canPictureInPicture)&&await this.enterPictureInPicture(),r}finally{this.#u=!1}}}#o(e){let t=u(this.#a);return e==="prefer-media"&&this.#r.supported||e==="media"?this.#r:t?.fullscreen}async enterPictureInPicture(e){if(this.#p(),!this.$state.pictureInPicture())return e&&this.#e.queue.enqueue("media-enter-pip-request",e),await this.#a().pictureInPicture.enter()}async exitPictureInPicture(e){if(this.#p(),!!this.$state.pictureInPicture())return e&&this.#e.queue.enqueue("media-exit-pip-request",e),await this.#a().pictureInPicture.exit()}#p(){if(!this.$state.canPictureInPicture())throw Error("[vidstack] no pip support")}#y(){this.controls.defaultDelay=this.$props.controlsDelay()}#f(){let{canSetAudioGain:e}=this.$state,t=!!this.#a()?.audioGain?.supported;e.set(t)}#m(){let{canAirPlay:e}=this.$state,t=!!this.#a()?.airPlay?.supported;e.set(t)}#b(){let{canGoogleCast:e,source:t}=this.$state,i=mt&&!pt&&kt(t());e.set(i)}#E(){let{canFullscreen:e}=this.$state,t=this.#r.supported||!!this.#a()?.fullscreen?.supported;e.set(t)}#k(){let{canPictureInPicture:e}=this.$state,t=!!this.#a()?.pictureInPicture?.supported;e.set(t)}async"media-airplay-request"(e){try{await this.requestAirPlay(e)}catch{}}async requestAirPlay(e){try{let t=this.#a()?.airPlay;if(!t?.supported)throw Error("No AirPlay adapter.");return e&&this.#e.queue.enqueue("media-airplay-request",e),await t.prompt()}catch(t){throw this.#e.queue.delete("media-airplay-request"),t}}async"media-google-cast-request"(e){try{await this.requestGoogleCast(e)}catch{}}#g;async requestGoogleCast(e){try{let{canGoogleCast:t}=this.$state;if(!u(t)){let r=Error("Cast not available.");throw r.code="CAST_NOT_AVAILABLE",r}if(V("https://www.gstatic.com"),!this.#g){let r=await import("./vidstack-DAXYTZ2K.js");this.#g=new r.GoogleCastLoader}await this.#g.prompt(this.#i),e&&this.#e.queue.enqueue("media-google-cast-request",e);let i=u(this.$state.remotePlaybackState)!=="disconnected";i&&this.$state.savedState.set({paused:u(this.$state.paused),currentTime:u(this.$state.currentTime)}),this.$state.remotePlaybackLoader.set(i?this.#g:null)}catch(t){throw this.#e.queue.delete("media-google-cast-request"),t}}"media-clip-start-change-request"(e){let{clipStartTime:t}=this.$state;t.set(e.detail)}"media-clip-end-change-request"(e){let{clipEndTime:t}=this.$state;t.set(e.detail),this.dispatch("duration-change",{detail:e.detail,trigger:e})}"media-duration-change-request"(e){let{providedDuration:t,clipEndTime:i}=this.$state;t.set(e.detail),i()<=0&&this.dispatch("duration-change",{detail:e.detail,trigger:e})}"media-audio-track-change-request"(e){let{logger:t,audioTracks:i}=this.#i;if(i.readonly)return;let r=e.detail,s=i[r];if(s){let n=e.type;this.#e.queue.enqueue(n,e),s.selected=!0}}async"media-enter-fullscreen-request"(e){try{await this.enterFullscreen(e.detail,e)}catch(t){this.#T(t,e)}}async"media-exit-fullscreen-request"(e){try{await this.exitFullscreen(e.detail,e)}catch(t){this.#T(t,e)}}async#M(e){let t=u(this.$props.fullscreenOrientation),i=e.detail;if(!(at(t)||t==="none"||!this.#s.supported))if(i){if(this.#s.locked)return;this.dispatch("media-orientation-lock-request",{detail:t,trigger:e})}else this.#s.locked&&this.dispatch("media-orientation-unlock-request",{trigger:e})}#T(e,t){this.#t.handle(this.createEvent("fullscreen-error",{detail:me(e)}))}async"media-orientation-lock-request"(e){let t=e.type;try{this.#e.queue.enqueue(t,e),await this.#s.lock(e.detail)}catch{this.#e.queue.delete(t)}}async"media-orientation-unlock-request"(e){let t=e.type;try{this.#e.queue.enqueue(t,e),await this.#s.unlock()}catch{this.#e.queue.delete(t)}}async"media-enter-pip-request"(e){try{await this.enterPictureInPicture(e)}catch(t){this.#v(t,e)}}async"media-exit-pip-request"(e){try{await this.exitPictureInPicture(e)}catch(t){this.#v(t,e)}}#v(e,t){this.#t.handle(this.createEvent("picture-in-picture-error",{detail:me(e)}))}"media-live-edge-request"(e){let{live:t,liveEdge:i,canSeek:r}=this.$state;if(!(!t()||i()||!r())){this.#e.queue.enqueue("media-seek-request",e);try{this.seekToLiveEdge()}catch{this.#e.queue.delete("media-seek-request")}}}async"media-loop-request"(e){try{this.#e.looping=!0,this.#e.replaying=!0,await this.play(e)}catch{this.#e.looping=!1}}"media-user-loop-change-request"(e){this.$state.userPrefersLoop.set(e.detail)}async"media-pause-request"(e){if(!this.$state.paused())try{await this.pause(e)}catch{}}async"media-play-request"(e){if(this.$state.paused())try{await this.play(e)}catch{}}"media-rate-change-request"(e){let{playbackRate:t,canSetPlaybackRate:i}=this.$state;if(t()===e.detail||!i())return;let r=this.#a();r?.setPlaybackRate&&(this.#e.queue.enqueue("media-rate-change-request",e),r.setPlaybackRate(e.detail))}"media-audio-gain-change-request"(e){try{this.setAudioGain(e.detail,e)}catch{}}"media-quality-change-request"(e){let{qualities:t,storage:i,logger:r}=this.#i;if(t.readonly)return;this.#e.queue.enqueue("media-quality-change-request",e);let s=e.detail;if(s<0)t.autoSelect(e),e.isOriginTrusted&&i?.setVideoQuality?.(null);else{let n=t[s];n&&(n.selected=!0,e.isOriginTrusted&&i?.setVideoQuality?.({id:n.id,width:n.width,height:n.height,bitrate:n.bitrate}))}}"media-pause-controls-request"(e){let t=e.type;this.#e.queue.enqueue(t,e),this.controls.pause(e)}"media-resume-controls-request"(e){let t=e.type;this.#e.queue.enqueue(t,e),this.controls.resume(e)}"media-seek-request"(e){let{seekableStart:t,seekableEnd:i,ended:r,canSeek:s,live:n,userBehindLiveEdge:o,clipStartTime:d}=this.$state,l=e.detail;r()&&(this.#e.replaying=!0);let p=e.type;this.#e.seeking=!1,this.#e.queue.delete(p);let b=l+d(),E=Math.floor(b)===Math.floor(i()),g=E?i():Math.min(Math.max(t()+.1,b),i()-.1);!Number.isFinite(g)||!s()||(this.#e.queue.enqueue(p,e),this.#a().setCurrentTime(g),n()&&e.isOriginTrusted&&Math.abs(i()-g)>=2&&o.set(!0))}"media-seeking-request"(e){let t=e.type;this.#e.queue.enqueue(t,e),this.$state.seeking.set(!0),this.#e.seeking=!0}"media-start-loading"(e){if(this.$state.canLoad())return;let t=e.type;this.#e.queue.enqueue(t,e),this.#t.handle(this.createEvent("can-load"))}"media-poster-start-loading"(e){if(this.$state.canLoadPoster())return;let t=e.type;this.#e.queue.enqueue(t,e),this.#t.handle(this.createEvent("can-load-poster"))}"media-text-track-change-request"(e){let{index:t,mode:i}=e.detail,r=this.#i.textTracks[t];if(r){let s=e.type;this.#e.queue.enqueue(s,e),r.setMode(i,e)}}"media-mute-request"(e){if(this.$state.muted())return;let t=e.type;this.#e.queue.enqueue(t,e),this.#a().setMuted(!0)}"media-unmute-request"(e){let{muted:t,volume:i}=this.$state;if(!t())return;let r=e.type;this.#e.queue.enqueue(r,e),this.#i.$provider().setMuted(!1),i()===0&&(this.#e.queue.enqueue(r,e),this.#a().setVolume(.25))}"media-volume-change-request"(e){let{muted:t,volume:i}=this.$state,r=e.detail;if(i()===r)return;let s=e.type;this.#e.queue.enqueue(s,e),this.#a().setVolume(r),r>0&&t()&&(this.#e.queue.enqueue(s,e),this.#a().setMuted(!1))}#P(e,t,i){}};function je(a,e){if(!(a&&e))throw Error("[vidstack] media not ready")}function Ht(a,e){if(!e?.supported)throw Error("[vidstack] no fullscreen support")}var Ie=class{seeking=!1;looping=!1;replaying=!1;queue=new Ae};var Gt=new Set(["auto-play","auto-play-fail","can-load","sources-change","source-change","load-start","abort","error","loaded-metadata","loaded-data","can-play","play","play-fail","pause","playing","seeking","seeked","waiting"]);var De=class extends M{#t;#e;#i=new Map;#r=!1;#s=[];#a=[-1,-1];#n=!1;#l;constructor(e,t){super(),this.#t=e,this.#e=t}onAttach(e){e.setAttribute("aria-busy","true"),this.listen("fullscreen-change",this["fullscreen-change"].bind(this)),this.listen("fullscreen-error",this["fullscreen-error"].bind(this)),this.listen("orientation-change",this["orientation-change"].bind(this))}onConnect(e){c(this.#$.bind(this)),this.#p(),this.#y(),this.#f(),this.#c(),T(this.#h.bind(this))}onDestroy(){let{audioTracks:e,qualities:t,textTracks:i}=this.#e;e[h.reset](),t[h.reset](),i[h.reset](),this.#S()}handle(e){if(!this.scope)return;let t=e.type;D(()=>this[e.type]?.(e)),Gt.has(t)&&this.#i.set(t,e),this.dispatch(e)}#d=!1;#c(){this.#d&&(requestAnimationFrame(()=>{this.scope&&this.#e.remote.play(new y("dom-connect"))}),this.#d=!1)}#h(){this.#d||(this.#d=!this.$state.paused(),this.#e.$provider()?.pause())}#u(){this.#C(),this.#r=!1,this.#t.replaying=!1,this.#t.looping=!1,this.#n=!1,this.#l=void 0,this.#i.clear()}#o(e,t){let i=this.#t.queue.serve(e);i&&(t.request=i,t.triggers.add(i))}#p(){this.#m(),this.#b();let e=this.#e.textTracks;f(e,"add",this.#m.bind(this)),f(e,"remove",this.#m.bind(this)),f(e,"mode-change",this.#b.bind(this))}#y(){let e=this.#e.qualities;f(e,"add",this.#g.bind(this)),f(e,"remove",this.#g.bind(this)),f(e,"change",this.#M.bind(this)),f(e,"auto-change",this.#T.bind(this)),f(e,"readonly-change",this.#x.bind(this))}#f(){let e=this.#e.audioTracks;f(e,"add",this.#E.bind(this)),f(e,"remove",this.#E.bind(this)),f(e,"change",this.#k.bind(this))}#m(e){let{textTracks:t}=this.$state;t.set(this.#e.textTracks.toArray()),this.dispatch("text-tracks-change",{detail:t(),trigger:e})}#b(e){e&&this.#o("media-text-track-change-request",e);let t=this.#e.textTracks.selected,{textTrack:i}=this.$state;i()!==t&&(i.set(t),this.dispatch("text-track-change",{detail:t,trigger:e}))}#E(e){let{audioTracks:t}=this.$state;t.set(this.#e.audioTracks.toArray()),this.dispatch("audio-tracks-change",{detail:t(),trigger:e})}#k(e){let{audioTrack:t}=this.$state;t.set(this.#e.audioTracks.selected),e&&this.#o("media-audio-track-change-request",e),this.dispatch("audio-track-change",{detail:t(),trigger:e})}#g(e){let{qualities:t}=this.$state;t.set(this.#e.qualities.toArray()),this.dispatch("qualities-change",{detail:t(),trigger:e})}#M(e){let{quality:t}=this.$state;t.set(this.#e.qualities.selected),e&&this.#o("media-quality-change-request",e),this.dispatch("quality-change",{detail:t(),trigger:e})}#T(){let{qualities:e}=this.#e,t=e.auto;this.$state.autoQuality.set(t),t||this.#S()}#v=null;#P(){this.#S(),this.#v=c(()=>{let{qualities:e}=this.#e,{mediaWidth:t,mediaHeight:i}=this.$state,r=t(),s=i();if(r===0||s===0)return;let n=null,o=1/0;for(let d of e){let l=Math.abs(d.width-r)+Math.abs(d.height-s);l<o&&(o=l,n=d)}n&&e[h.select](n,!0,new y("resize",{detail:{width:r,height:s}}))})}#S(){this.#v?.(),this.#v=null}#x(){this.$state.canSetQuality.set(!this.#e.qualities.readonly)}#$(){let{canSetVolume:e,isGoogleCastConnected:t}=this.$state;if(t()){e.set(!1);return}gt().then(e.set)}"provider-change"(e){let t=this.#e.$provider(),i=e.detail;t?.type!==i?.type&&(t?.destroy?.(),t?.scope?.dispose(),this.#e.$provider.set(e.detail),t&&e.detail===null&&this.#L(e))}"provider-loader-change"(e){}"auto-play"(e){this.$state.autoPlayError.set(null)}"auto-play-fail"(e){this.$state.autoPlayError.set(e.detail),this.#u()}"can-load"(e){this.$state.canLoad.set(!0),this.#i.set("can-load",e),this.#e.textTracks[v.canLoad](),this.#o("media-start-loading",e)}"can-load-poster"(e){this.$state.canLoadPoster.set(!0),this.#i.set("can-load-poster",e),this.#o("media-poster-start-loading",e)}"media-type-change"(e){let t=this.#i.get("source-change");t&&e.triggers.add(t);let i=this.$state.viewType();this.$state.mediaType.set(e.detail);let r=this.$state.providedViewType(),s=r==="unknown"?e.detail:r;i!==s&&setTimeout(()=>{requestAnimationFrame(()=>{this.scope&&(this.$state.inferredViewType.set(e.detail),this.dispatch("view-type-change",{detail:s,trigger:e}))})},0)}"stream-type-change"(e){let t=this.#i.get("source-change");t&&e.triggers.add(t);let{streamType:i,inferredStreamType:r}=this.$state;r.set(e.detail),e.detail=i()}"rate-change"(e){let{storage:t}=this.#e,{canPlay:i}=this.$state;this.$state.playbackRate.set(e.detail),this.#o("media-rate-change-request",e),i()&&t?.setPlaybackRate?.(e.detail)}"remote-playback-change"(e){let{remotePlaybackState:t,remotePlaybackType:i}=this.$state,{type:r,state:s}=e.detail,n=s==="connected";i.set(r),t.set(s);let o=r==="airplay"?"media-airplay-request":"media-google-cast-request";if(n)this.#o(o,e);else{let d=this.#t.queue.peek(o);d&&(e.request=d,e.triggers.add(d))}}"sources-change"(e){let t=this.$state.sources(),i=e.detail;this.$state.sources.set(i),this.#A(t,i,e)}#A(e,t,i){let{qualities:r}=this.#e,s=!1,n=!1;for(let o of e){if(!te(o))continue;if(!t.some(l=>l.src===o.src)){let l=r.getBySrc(o.src);l&&(r[h.remove](l,i),n=!0)}}n&&!r.length&&(this.$state.savedState.set(null),r[h.reset](i));for(let o of t){if(!te(o)||r.getBySrc(o.src))continue;let d={id:o.id??o.height+"p",bitrate:null,codec:null,...o,selected:!1};r[h.add](d,i),s=!0}s&&!r[w.enableAuto]&&(this.#P(),r[w.enableAuto]=this.#P.bind(this),r[w.setAuto](!0,i))}"source-change"(e){e.isQualityChange=e.originEvent?.type==="quality-change";let t=e.detail;this.#L(e,e.isQualityChange),this.#i.set(e.type,e),this.$state.source.set(t),this.el?.setAttribute("aria-busy","true")}#L(e,t=!1){let{audioTracks:i,qualities:r}=this.#e;if(!t){this.#s=[],this.#a=[-1,-1],i[h.reset](e),r[h.reset](e),ze(this.$state,t),this.#u();return}ze(this.$state,t),this.#u()}abort(e){let t=this.#i.get("source-change");t&&e.triggers.add(t);let i=this.#i.get("can-load");i&&!e.triggers.hasType("can-load")&&e.triggers.add(i)}"load-start"(e){let t=this.#i.get("source-change");t&&e.triggers.add(t)}error(e){this.$state.error.set(e.detail);let t=this.#i.get("abort");t&&e.triggers.add(t)}"loaded-metadata"(e){let t=this.#i.get("load-start");t&&e.triggers.add(t)}"loaded-data"(e){let t=this.#i.get("load-start");t&&e.triggers.add(t)}"can-play"(e){let t=this.#i.get("loaded-metadata");t&&e.triggers.add(t),this.#_(e.detail),this.el?.setAttribute("aria-busy","false")}"can-play-through"(e){this.#_(e.detail);let t=this.#i.get("can-play");t&&e.triggers.add(t)}#_(e){let{seekable:t,buffered:i,intrinsicDuration:r,canPlay:s}=this.$state;s.set(!0),i.set(e.buffered),t.set(e.seekable);let n=O(e.seekable)??1/0;r.set(n)}"duration-change"(e){let{live:t,intrinsicDuration:i,providedDuration:r,clipEndTime:s,ended:n}=this.$state,o=e.detail;if(!t()){let d=Number.isNaN(o)?0:o;i.set(d),n()&&this.#R(e)}(r()>0||s()>0)&&e.stopImmediatePropagation()}progress(e){let{buffered:t,bufferedEnd:i,seekable:r,seekableEnd:s,live:n,intrinsicDuration:o}=this.$state,{buffered:d,seekable:l}=e.detail,p=O(d)??1/0,b=d.length!==t().length,E=p>i(),g=O(l)??1/0,S=l.length!==r().length,_=g>s();(b||E)&&t.set(d),(S||_)&&r.set(l),n()&&(o.set(g),this.dispatch("duration-change",{detail:g,trigger:e}))}play(e){let{paused:t,autoPlayError:i,ended:r,autoPlaying:s,playsInline:n,pointer:o,muted:d,viewType:l,live:p,userBehindLiveEdge:b}=this.$state;if(this.#q(),!t()){e.stopImmediatePropagation();return}e.autoPlay=s();let E=this.#i.get("waiting");E&&e.triggers.add(E),this.#o("media-play-request",e),this.#i.set("play",e),t.set(!1),i.set(null),e.autoPlay&&(this.handle(this.createEvent("auto-play",{detail:{muted:d()},trigger:e})),s.set(!1)),(r()||this.#t.replaying)&&(this.#t.replaying=!1,r.set(!1),this.handle(this.createEvent("replay",{trigger:e}))),!n()&&l()==="video"&&o()==="coarse"&&this.#e.remote.enterFullscreen("prefer-media",e),p()&&!b()&&this.#e.remote.seekToLiveEdge(e)}#q(e){if(!u(this.#e.$provider))return;let{ended:i,seekableStart:r,clipStartTime:s,clipEndTime:n,realCurrentTime:o,duration:d}=this.$state,l=o()<s()||n()>0&&o()>=n()||Math.abs(o()-d())<.1||i();return l&&this.dispatch("media-seek-request",{detail:(s()>0?0:r())+.1,trigger:e}),l}"play-fail"(e){let{muted:t,autoPlaying:i}=this.$state,r=this.#i.get("play");r&&e.triggers.add(r),this.#o("media-play-request",e);let{paused:s,playing:n}=this.$state;s.set(!0),n.set(!1),this.#u(),this.#i.set("play-fail",e),e.autoPlay&&(this.handle(this.createEvent("auto-play-fail",{detail:{muted:t(),error:e.detail},trigger:e})),i.set(!1))}playing(e){let t=this.#i.get("play"),i=this.#i.get("seeked");t?e.triggers.add(t):i&&e.triggers.add(i),setTimeout(()=>this.#u(),0);let{paused:r,playing:s,live:n,liveSyncPosition:o,seekableEnd:d,started:l,currentTime:p,seeking:b,ended:E}=this.$state;if(r.set(!1),s.set(!0),b.set(!1),E.set(!1),this.#t.looping){this.#t.looping=!1;return}if(n()&&!l()&&p()===0){let g=o()??d()-2;Number.isFinite(g)&&this.#e.$provider().setCurrentTime(g)}this.started(e)}started(e){let{started:t}=this.$state;t()||(t.set(!0),this.handle(this.createEvent("started",{trigger:e})))}pause(e){this.el?.isConnected||(this.#d=!0),this.#o("media-pause-request",e);let t=this.#i.get("seeked");t&&e.triggers.add(t);let{paused:i,playing:r}=this.$state;i.set(!0),r.set(!1),this.#r&&setTimeout(()=>{this.handle(this.createEvent("end",{trigger:e})),this.#r=!1},0),this.#u()}"time-change"(e){if(this.#t.looping){e.stopImmediatePropagation();return}let{waiting:t,played:i,clipEndTime:r,realCurrentTime:s,currentTime:n}=this.$state,o=e.detail,d=r();s.set(o),this.#V(),t.set(!1);for(let l of this.#e.textTracks)l[v.updateActiveCues](o,e);d>0&&o>=d&&(this.#r=!0,this.dispatch("media-pause-request",{trigger:e})),this.#I(),this.dispatch("time-update",{detail:{currentTime:n(),played:i()},trigger:e})}#V(){let{currentTime:e,played:t,paused:i}=this.$state;i()||(this.#a=Et(this.#s,this.#a,e()),t.set(new U(this.#s)))}#R(e){let{clipStartTime:t,clipEndTime:i,duration:r}=this.$state;t()>0||i()>0||this.handle(this.createEvent("time-change",{detail:r(),trigger:e}))}#I(){let{storage:e}=this.#e,{canPlay:t,realCurrentTime:i}=this.$state;t()&&e?.setTime?.(i())}"audio-gain-change"(e){let{storage:t}=this.#e,{canPlay:i,audioGain:r}=this.$state;r.set(e.detail),this.#o("media-audio-gain-change-request",e),i()&&t?.setAudioGain?.(r())}"volume-change"(e){let{storage:t}=this.#e,{volume:i,muted:r,canPlay:s}=this.$state,n=e.detail;i.set(n.volume),r.set(n.muted||n.volume===0),this.#o("media-volume-change-request",e),this.#o(n.muted?"media-mute-request":"media-unmute-request",e),s()&&(t?.setVolume?.(i()),t?.setMuted?.(r()))}seeking=he(e=>{let{seeking:t,realCurrentTime:i,paused:r}=this.$state;t.set(!0),i.set(e.detail),this.#o("media-seeking-request",e),r()&&(this.#l=e,this.#w()),this.#a=[-1,-1]},150,{leading:!0});seeked(e){let{seeking:t,currentTime:i,realCurrentTime:r,paused:s,seekableEnd:n,ended:o}=this.$state;if(this.#t.seeking)t.set(!0),e.stopImmediatePropagation();else if(t()){let d=this.#i.get("waiting");d&&e.triggers.add(d);let l=this.#i.get("seeking");l&&!e.triggers.has(l)&&e.triggers.add(l),s()&&this.#C(),t.set(!1),r.set(e.detail),this.#o("media-seek-request",e);let p=e?.originEvent;p?.isTrusted&&!(p instanceof MessageEvent)&&!/seek/.test(p.type)&&this.started(e)}Math.floor(i())!==Math.floor(n())?o.set(!1):this.end(e)}waiting(e){this.#n||this.#t.seeking||(e.stopImmediatePropagation(),this.#l=e,this.#w())}#w=pe(()=>{if(!this.#l)return;this.#n=!0;let{waiting:e,playing:t}=this.$state;e.set(!0),t.set(!1);let i=this.createEvent("waiting",{trigger:this.#l});this.#i.set("waiting",i),this.dispatch(i),this.#l=void 0,this.#n=!1},300);end(e){let{loop:t,ended:i}=this.$state;if(!(!t()&&i())){if(t()){setTimeout(()=>{requestAnimationFrame(()=>{this.#q(e),this.dispatch("media-loop-request",{trigger:e})})},10);return}setTimeout(()=>this.#D(e),0)}}#D(e){let{storage:t}=this.#e,{paused:i,seeking:r,ended:s,duration:n}=this.$state;this.#R(e),i()||this.dispatch("pause",{trigger:e}),r()&&this.dispatch("seeked",{detail:n(),trigger:e}),s.set(!0),this.#u(),t?.setTime?.(n(),!0),this.dispatch("ended",{trigger:e})}#C(){this.#w.cancel(),this.$state.waiting.set(!1)}"fullscreen-change"(e){let t=e.detail;this.$state.fullscreen.set(t),this.#o(t?"media-enter-fullscreen-request":"media-exit-fullscreen-request",e)}"fullscreen-error"(e){this.#o("media-enter-fullscreen-request",e),this.#o("media-exit-fullscreen-request",e)}"orientation-change"(e){let t=e.detail.lock;this.#o(t?"media-orientation-lock-request":"media-orientation-unlock-request",e)}"picture-in-picture-change"(e){let t=e.detail;this.$state.pictureInPicture.set(t),this.#o(t?"media-enter-pip-request":"media-exit-pip-request",e)}"picture-in-picture-error"(e){this.#o("media-enter-pip-request",e),this.#o("media-exit-pip-request",e)}"title-change"(e){e.trigger&&(e.stopImmediatePropagation(),this.$state.inferredTitle.set(e.detail))}"poster-change"(e){e.trigger&&(e.stopImmediatePropagation(),this.$state.inferredPoster.set(e.detail))}};var Oe=class extends M{onSetup(){this.#t();let e=[this.#r,this.#a,this.#o,this.#p,this.#l,this.#c,this.#h,this.#y,this.#m,this.#f,this.#n,this.#u,this.#d,this.#e,this.#s];for(let t of e)c(t.bind(this))}#t(){let e={duration:"providedDuration",loop:"providedLoop",poster:"providedPoster",streamType:"providedStreamType",title:"providedTitle",viewType:"providedViewType"},t=new Set(["currentTime","paused","playbackRate","volume"]);for(let i of Object.keys(this.$props))t.has(i)||this.$state[e[i]??i]?.set(this.$props[i]());this.$state.muted.set(this.$props.muted()||this.$props.volume()===0)}#e(){let{viewType:e,streamType:t,title:i,poster:r,loop:s}=this.$props,n=this.$state;n.providedPoster.set(r()),n.providedStreamType.set(t()),n.providedViewType.set(e()),n.providedTitle.set(i()),n.providedLoop.set(s())}#i(){}#r(){let{artist:e,artwork:t}=this.$props;this.$state.artist.set(e()),this.$state.artwork.set(t())}#s(){let{title:e}=this.$state;this.dispatch("title-change",{detail:e()})}#a(){let e=this.$props.autoPlay()||this.$props.autoplay();this.$state.autoPlay.set(e),this.dispatch("auto-play-change",{detail:e})}#n(){let e=this.$state.loop();this.dispatch("loop-change",{detail:e})}#l(){let e=this.$props.controls();this.$state.controls.set(e)}#d(){let{poster:e}=this.$state;this.dispatch("poster-change",{detail:e()})}#c(){let e=this.$props.crossOrigin()??this.$props.crossorigin(),t=e===!0?"":e;this.$state.crossOrigin.set(t)}#h(){let{duration:e}=this.$props;this.dispatch("media-duration-change-request",{detail:e()})}#u(){let e=this.$props.playsInline()||this.$props.playsinline();this.$state.playsInline.set(e),this.dispatch("plays-inline-change",{detail:e})}#o(){let{clipStartTime:e}=this.$props;this.dispatch("media-clip-start-change-request",{detail:e()})}#p(){let{clipEndTime:e}=this.$props;this.dispatch("media-clip-end-change-request",{detail:e()})}#y(){this.dispatch("live-change",{detail:this.$state.live()})}#f(){this.$state.liveEdgeTolerance.set(this.$props.liveEdgeTolerance()),this.$state.minLiveDVRWindow.set(this.$props.minLiveDVRWindow())}#m(){this.dispatch("live-edge-change",{detail:this.$state.liveEdge()})}};var Qt=["play","pause","seekforward","seekbackward","seekto"],Fe=class extends M{onConnect(){c(this.#e.bind(this)),c(this.#i.bind(this));let e=this.#r.bind(this);for(let t of Qt)navigator.mediaSession.setActionHandler(t,e);T(this.#t.bind(this))}#t(){for(let e of Qt)navigator.mediaSession.setActionHandler(e,null)}#e(){let{title:e,artist:t,artwork:i,poster:r}=this.$state;navigator.mediaSession.metadata=new MediaMetadata({title:e(),artist:t(),artwork:i()??[{src:r()}]})}#i(){let{canPlay:e,paused:t}=this.$state;navigator.mediaSession.playbackState=e()?t()?"paused":"playing":"none"}#r(e){let t=new y("media-session-action",{detail:e});switch(e.action){case"play":this.dispatch("media-play-request",{trigger:t});break;case"pause":this.dispatch("media-pause-request",{trigger:t});break;case"seekto":case"seekforward":case"seekbackward":this.dispatch("media-seek-request",{detail:X(e.seekTime)?e.seekTime:this.$state.currentTime()+(e.seekOffset??10),trigger:t});break}}};var Kt=class a extends N{static props=Ft;static state=Ye;#t;#e;#i;canPlayQueue=new z;remoteControl;get#r(){return this.#t.$provider()}get#s(){return this.$props}constructor(){super(),new Oe;let e={player:this,qualities:new Me,audioTracks:new ke,storage:null,$provider:P(null),$providerSetup:P(!1),$props:this.$props,$state:this.$state};e.remote=this.remoteControl=new ge(void 0),e.remote.setPlayer(this),e.textTracks=new be,e.textTracks[v.crossOrigin]=this.$state.crossOrigin,e.textRenderers=new Te(e),e.ariaKeys={},this.#t=e,lt(Mt,e),this.orientation=new B,new Lt,new Se(e);let t=new Ie;this.#e=new De(t,e),this.#i=new Ve(this.#e,t,e),e.delegate=new $e(this.#e.handle.bind(this.#e),e),e.notify=e.delegate.notify.bind(e.delegate),typeof navigator<"u"&&"mediaSession"in navigator&&new Fe,new re("load",this.startLoading.bind(this)),new re("posterLoad",this.startLoadingPoster.bind(this))}onSetup(){this.#c(),c(this.#d.bind(this)),c(this.#f.bind(this)),c(this.#p.bind(this)),c(this.#k.bind(this)),c(this.#b.bind(this)),c(this.#v.bind(this)),c(this.#M.bind(this))}onAttach(e){e.setAttribute("data-media-player",""),We(e,"tabindex","0"),We(e,"role","region"),c(this.#S.bind(this)),c(this.#n.bind(this)),c(this.#l.bind(this)),f(e,"find-media-player",this.#h.bind(this))}onConnect(e){de&&J(e,"data-iphone","");let t=window.matchMedia("(pointer: coarse)");this.#o(t),t.onchange=this.#o.bind(this);let i=new ResizeObserver(oe(this.#u.bind(this)));i.observe(e),c(this.#u.bind(this)),this.dispatch("media-player-connect",{detail:this,bubbles:!0,composed:!0}),T(()=>{i.disconnect(),t.onchange=null})}onDestroy(){this.#t.player=null,this.canPlayQueue.reset()}#a=!1;#n(){let e=this.$el,{title:t,live:i,viewType:r,providedTitle:s}=this.$state,n=i(),o=ct(r()),d=o!=="Unknown"?`${n?"Live ":""}${o}`:n?"Live":"Media",l=t();J(this.el,"aria-label",`${d} Player`+(l?` - ${l}`:"")),e?.hasAttribute("title")&&(this.#a=!0,e?.removeAttribute("title"))}#l(){let e=this.orientation.landscape?"landscape":"portrait";this.$state.orientation.set(e),J(this.el,"data-orientation",e),this.#u()}#d(){this.$state.canPlay()&&this.#r?this.canPlayQueue.start():this.canPlayQueue.stop()}#c(){if(a[Ce]){this.setAttributes(a[Ce]);return}let e={"data-load":function(){return this.$props.load()},"data-captions":function(){let i=this.$state.textTrack();return!!i&&k(i)},"data-ios-controls":function(){return this.$state.iOSControls()},"data-controls":function(){return this.controls.showing},"data-buffering":function(){let{canLoad:i,canPlay:r,waiting:s}=this.$state;return i()&&(!r()||s())},"data-error":function(){let{error:i}=this.$state;return!!i()},"data-autoplay-error":function(){let{autoPlayError:i}=this.$state;return!!i()}},t={autoPlay:"autoplay",canAirPlay:"can-airplay",canPictureInPicture:"can-pip",pictureInPicture:"pip",playsInline:"playsinline",remotePlaybackState:"remote-state",remotePlaybackType:"remote-type",isAirPlayConnected:"airplay",isGoogleCastConnected:"google-cast"};for(let i of Ot){let r="data-"+(t[i]??ut(i));e[r]=function(){return this.$state[i]()}}delete e.title,a[Ce]=e,this.setAttributes(e)}#h(e){e.detail(this)}#u(){if(!this.el)return;let e=this.el.clientWidth,t=this.el.clientHeight;this.$state.width.set(e),this.$state.height.set(t),Q(this.el,"--player-width",e+"px"),Q(this.el,"--player-height",t+"px")}#o(e){let t=e.matches?"coarse":"fine";J(this.el,"data-pointer",t),this.$state.pointer.set(t),this.#u()}get provider(){return this.#r}get controls(){return this.#i.controls}set controls(e){this.#s.controls.set(e)}orientation;get title(){return u(this.$state.providedTitle)}set title(e){if(this.#a){this.#a=!1;return}this.$state.providedTitle.set(e)}get qualities(){return this.#t.qualities}get audioTracks(){return this.#t.audioTracks}get textTracks(){return this.#t.textTracks}get textRenderers(){return this.#t.textRenderers}get duration(){return this.$state.duration()}set duration(e){this.#s.duration.set(e)}get paused(){return u(this.$state.paused)}set paused(e){this.#y(e)}#p(){this.#y(this.$props.paused())}#y(e){e?this.canPlayQueue.enqueue("paused",()=>this.#i.pause()):this.canPlayQueue.enqueue("paused",()=>this.#i.play())}get muted(){return u(this.$state.muted)}set muted(e){this.#m(e)}#f(){this.#m(this.$props.muted())}#m(e){this.canPlayQueue.enqueue("muted",()=>{this.#r&&this.#r.setMuted(e)})}get currentTime(){return u(this.$state.currentTime)}set currentTime(e){this.#E(e)}#b(){this.#E(this.$props.currentTime())}#E(e){this.canPlayQueue.enqueue("currentTime",()=>{let{currentTime:t,clipStartTime:i,seekableStart:r,seekableEnd:s}=this.$state;e!==u(t)&&u(()=>{if(!this.#r)return;let n=e+i(),o=Math.floor(n)===Math.floor(s()),d=o?s():Math.min(Math.max(r()+.1,n),s()-.1);Number.isFinite(d)&&this.#r.setCurrentTime(d)})})}get volume(){return u(this.$state.volume)}set volume(e){this.#g(e)}#k(){this.#g(this.$props.volume())}#g(e){let t=St(0,e,1);this.canPlayQueue.enqueue("volume",()=>{this.#r&&this.#r.setVolume(t)})}get playbackRate(){return u(this.$state.playbackRate)}set playbackRate(e){this.#T(e)}#M(){this.#T(this.$props.playbackRate())}#T(e){this.canPlayQueue.enqueue("rate",()=>{this.#r&&this.#r.setPlaybackRate?.(e)})}#v(){this.#P(this.$props.playsInline())}#P(e){this.canPlayQueue.enqueue("playsinline",()=>{this.#r&&this.#r.setPlaysInline?.(e)})}#S(){let e=this.$props.storage(),t=m(e)?new ve:e;if(t?.onChange){let{source:i}=this.$state,r=m(e)?e:this.el?.id,s=ae(this.#x.bind(this));c(()=>t.onChange(i(),s(),r||void 0))}this.#t.storage=t,this.#t.textTracks.setStorage(t),T(()=>{t?.onDestroy?.(),this.#t.storage=null,this.#t.textTracks.setStorage(null)})}#x(){let{clipStartTime:e,clipEndTime:t}=this.$props,{source:i}=this.$state,r=i();return r.src?`${r.src}:${e()}:${t()}`:null}async play(e){return this.#i.play(e)}async pause(e){return this.#i.pause(e)}async enterFullscreen(e,t){return this.#i.enterFullscreen(e,t)}async exitFullscreen(e,t){return this.#i.exitFullscreen(e,t)}enterPictureInPicture(e){return this.#i.enterPictureInPicture(e)}exitPictureInPicture(e){return this.#i.exitPictureInPicture(e)}seekToLiveEdge(e){this.#i.seekToLiveEdge(e)}startLoading(e){this.#t.notify("can-load",void 0,e)}startLoadingPoster(e){this.#t.notify("can-load-poster",void 0,e)}requestAirPlay(e){return this.#i.requestAirPlay(e)}requestGoogleCast(e){return this.#i.requestGoogleCast(e)}setAudioGain(e,t){return this.#i.setAudioGain(e,t)}destroy(){super.destroy(),this.#t.remote.setPlayer(null),this.dispatch("destroy")}};function Nt(a,e){return fetch(a,e).then(t=>t.text()).then(t=>/type="static"/.test(t)?"on-demand":"live")}function Xe(a,e){return fetch(a,e).then(t=>t.text()).then(t=>{let i=li(t);if(i)return Xe(/^https?:/.test(i)?i:new URL(i,a).href,e);let r=/EXT-X-PLAYLIST-TYPE:\s*VOD/.test(t)?"on-demand":"live";return r==="live"&&ui(t)>=10&&(/#EXT-X-DVR-ENABLED:\s*true/.test(t)||t.includes("#EXT-X-DISCONTINUITY"))?"live:dvr":r})}function li(a){let e=a.match(/#EXT-X-STREAM-INF:[^\n]+(\n[^\n]+)*/g);return e?e[0].split(`
`)[1].trim():null}function ui(a){let e=a.split(`
`);for(let t of e)if(t.startsWith("#EXT-X-TARGETDURATION")){let i=parseFloat(t.split(":")[1]);if(!isNaN(i))return i}return-1}var Je=new Map,He=class{#t=!1;#e;#i;#r;#s;constructor(e,t,i,r=[]){this.#i=e,this.#r=t,this.#s=i;let s=new _e,n=new Le,o=new I,d=new we,l=new Re,p=new qe,b=[l,p];this.#e=ae(()=>{let g=t.$state.remotePlaybackLoader(),S=t.$props.preferNativeHLS()?[o,d,s,n,...b,...r]:[n,o,d,s,...b,...r];return g?[g,...S]:S});let{$state:E}=t;E.sources.set(Ut(t.$props.src()));for(let g of E.sources()){let S=this.#e().find(C=>C.canPlay(g));if(!S)continue;let _=S.mediaType(g);t.$state.source.set(g),t.$state.mediaType.set(_),t.$state.inferredViewType.set(_),this.#s.set(S),this.#t=!0;break}}connect(){let e=this.#s();this.#t&&(this.#d(this.#r.$state.source(),e),this.#c(e),this.#t=!1),c(this.#a.bind(this)),c(this.#n.bind(this)),c(this.#h.bind(this)),c(this.#u.bind(this)),c(this.#o.bind(this))}#a(){this.#r.notify("sources-change",[...Ut(this.#r.$props.src()),...this.#i()])}#n(){let{$state:e}=this.#r,t=e.sources(),i=u(e.source),r=this.#l(i,t);if(t[0]?.src&&!r.src&&!r.type){let{crossOrigin:n}=e,o=ce(n()),d=new AbortController;return Promise.all(t.map(l=>m(l.src)&&l.type==="?"?fetch(l.src,{method:"HEAD",credentials:o,signal:d.signal}).then(p=>(l.type=p.headers.get("content-type")||"??",Je.set(l.src,l.type),l)).catch(()=>l):l)).then(l=>{if(d.signal.aborted)return;let p=this.#l(u(e.source),l);$(),p.src||this.#r.notify("error",{message:"Failed to load resource.",code:4})}),()=>d.abort()}$()}#l(e,t){let i={src:"",type:""},r=null,s=new y("sources-change",{detail:{sources:t}}),n=this.#e(),{started:o,paused:d,currentTime:l,quality:p,savedState:b}=this.#r.$state;for(let E of t){let g=n.find(S=>S.canPlay(E));if(g){i=E,r=g;break}}if(te(i)){let E=p(),g=t.find(S=>S.src===E?.src);u(o)?b.set({paused:u(d),currentTime:u(l)}):b.set(null),g&&(i=g,s=new y("quality-change",{detail:{quality:E}}))}return Bt(e,i)||this.#d(i,r,s),r!==u(this.#s)&&this.#c(r,s),i}#d(e,t,i){this.#r.notify("source-change",e,i),this.#r.notify("media-type-change",t?.mediaType(e)||"unknown",i)}#c(e,t){this.#r.$providerSetup.set(!1),this.#r.notify("provider-change",null,t),e&&u(()=>e.preconnect?.(this.#r)),this.#s.set(e),this.#r.notify("provider-loader-change",e,t)}#h(){let e=this.#r.$provider();if(!(!e||u(this.#r.$providerSetup))){if(this.#r.$state.canLoad()){st(()=>e.setup(),e.scope),this.#r.$providerSetup.set(!0);return}u(()=>e.preconnect?.())}}#u(){if(!this.#r.$providerSetup())return;let e=this.#r.$provider(),t=this.#r.$state.source(),i=u(this.#r.$state.crossOrigin),r=u(this.#r.$props.preferNativeHLS);if(!Bt(e?.currentSrc,t)){if(this.#r.$state.canLoad()){let s=new AbortController;return Z(t)?(r||!ue())&&Xe(t.src,{credentials:ce(i),signal:s.signal}).then(n=>{this.#r.notify("stream-type-change",n)}).catch(Ke):ee(t)?Nt(t.src,{credentials:ce(i),signal:s.signal}).then(n=>{this.#r.notify("stream-type-change",n)}).catch(Ke):this.#r.notify("stream-type-change","on-demand"),u(()=>{let n=u(this.#r.$state.preload);return e?.loadSource(t,n).catch(o=>{})}),()=>s.abort()}try{m(t.src)&&V(new URL(t.src).origin)}catch{}}}#o(){let e=this.#s(),{providedPoster:t,source:i,canLoadPoster:r}=this.#r.$state;if(!e||!e.loadPoster||!i()||!r()||t())return;let s=new AbortController,n=new y("source-change",{detail:i});return e.loadPoster(i(),this.#r,s).then(o=>{this.#r.notify("poster-change",o||"",n)}).catch(()=>{this.#r.notify("poster-change","",n)}),()=>{s.abort()}}};function Ut(a){return(A(a)?a:[a]).map(e=>m(e)?{src:e,type:Wt(e)}:{...e,type:Wt(e.src,e.type)})}function Wt(a,e){return m(e)&&e.length?e:m(a)&&Je.has(a)?Je.get(a):!e&&Z({src:a,type:""})?"application/x-mpegurl":!e&&ee({src:a,type:""})?"application/dash+xml":!m(a)||a.startsWith("blob:")?"video/object":a.includes("youtube")||a.includes("youtu.be")?"video/youtube":a.includes("vimeo")&&!a.includes("progressive_redirect")&&!a.includes(".m3u8")?"video/vimeo":"?"}function Bt(a,e){return a?.src===e?.src&&a?.type===e?.type}var Ge=class{#t;#e;#i=[];constructor(e,t){this.#t=e,this.#e=t,c(this.#r.bind(this))}#r(){let e=this.#t();for(let t of this.#i)if(!e.some(i=>i.id===t.id)){let i=t.id&&this.#e.textTracks.getById(t.id);i&&this.#e.textTracks.remove(i)}for(let t of e){let i=t.id||F.createId(t);this.#e.textTracks.getById(i)||(t.id=i,this.#e.textTracks.add(t))}this.#i=e}};var Yt=class extends N{static props={loaders:[]};static state=new ne({loader:null});#t;#e;#i=P([]);#r=P([]);#s=null;onSetup(){this.#t=Pt(),this.#e=new He(this.#i,this.#t,this.$state.loader,this.$props.loaders())}onAttach(e){e.setAttribute("data-media-provider","")}onConnect(e){this.#e.connect(),new Ge(this.#r,this.#t);let t=new ResizeObserver(oe(this.#d.bind(this)));t.observe(e);let i=new MutationObserver(this.#c.bind(this));i.observe(e,{attributes:!0,childList:!0}),this.#d(),this.#c(),T(()=>{t.disconnect(),i.disconnect()})}#a=-1;load(e){e?.setAttribute("aria-hidden","true"),window.cancelAnimationFrame(this.#a),this.#a=requestAnimationFrame(()=>this.#n(e)),T(()=>{window.cancelAnimationFrame(this.#a)})}#n(e){if(!this.scope)return;let t=this.$state.loader(),{$provider:i}=this.#t;this.#s===t&&t?.target===e&&u(i)||(this.#l(),this.#s=t,t&&(t.target=e||null),!(!t||!e)&&t.load(this.#t).then(r=>{this.scope&&u(this.$state.loader)===t&&this.#t.notify("provider-change",r)}))}onDestroy(){this.#s=null,this.#l()}#l(){this.#t?.notify("provider-change",null)}#d(){if(!this.el)return;let{player:e,$state:t}=this.#t,i=this.el.offsetWidth,r=this.el.offsetHeight;e&&(t.mediaWidth.set(i),t.mediaHeight.set(r),e.el&&(Q(e.el,"--media-width",i+"px"),Q(e.el,"--media-height",r+"px")))}#c(){let e=[],t=[],i=this.el.children;for(let r of i)if(!r.hasAttribute("data-vds")){if(r instanceof HTMLSourceElement){let s={id:r.id,src:r.src,type:r.type};for(let n of["id","src","width","height","bitrate","codec"]){let o=r.getAttribute(`data-${n}`);m(o)&&(s[n]=/id|src|codec/.test(n)?o:Number(o))}e.push(s)}else if(r instanceof HTMLTrackElement){let s={src:r.src,kind:r.track.kind,language:r.srclang,label:r.label,default:r.default,type:r.getAttribute("data-type")};t.push({id:r.id||F.createId(s),...s})}}this.#i.set(e),this.#r.set(t),$()}};export{_t as a,W as b,ye as c,ki as d,B as e,te as f,Ye as g,ze as h,ge as i,ve as j,Te as k,be as l,ke as m,Me as n,yr as o,gr as p,vr as q,Er as r,Tr as s,br as t,kr as u,si as v,ai as w,Vt as x,Mr as y,Dt as z,xe as A,we as B,I as C,Le as D,_e as E,qe as F,Re as G,Kt as H,Yt as I};
